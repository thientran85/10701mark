(function(b){var d=document.getElementsByTagName("script");var c=d[d.length-1].src;var h=c.indexOf("/jqBingMap.");b.fn.jqBingMapSrc=c.substring(0,h);b.fn.jqBingMap=function(j,k){if(typeof j=="string"){if(j=="api"){return b(this).data("jqBingMap").interfaces[b(this).data("jqBingMap").current]}else{if(j=="interfaces"){return b(this).data("jqBingMap").interfaces}}}else{if(!j){j={}}opts=b.extend(true,{},b.fn.jqBingMap.defaults,j)}return b(this).each(function(){if(typeof j=="string"){command=j.toLowerCase();interfaces=b(this).jqBingMap("interfaces");if(typeof interfaces=="object"){if(k===true&&command=="destroy"){while(interfaces.length>0){interfaces[interfaces.length-1].destroy()}}else{if(k!==true){interfaces=[b(this).jqBingMap("api")]}for(i=0;i<interfaces.length;i++){if(command=="destroy"){interfaces[i].destroy()}else{if(interfaces[i].status.rendered===true){if(command=="show"){interfaces[i].show()}else{if(command=="alert"){interfaces[i].doAlert(k)}else{if(command=="resizemap"){interfaces[i].resizeMap(k)}else{if(command=="redrawpins"){interfaces[i].redrawPins(k)}else{if(command=="updatecount"){interfaces[i].updateCount(k)}else{if(command=="drawshapes"){interfaces[i].drawShapes(k)}}}}}}}}}}}}else{config=b.extend(true,{},opts);id=b.fn.jqBingMap.interfaces.length;for(i=0;i<id;i++){if(typeof b.fn.jqBingMap.interfaces[i]=="undefined"){id=i;break}}obj=new f(b(this),config,id);b.fn.jqBingMap.interfaces[id]=obj;if(typeof b(this).data("jqBingMap")=="object"){if(typeof b(this).attr("jqBingMap")==="undefined"){b(this).data("jqBingMap").current=b(this).data("jqBingMap").interfaces.length}b(this).data("jqBingMap").interfaces.push(obj)}else{b(this).data("jqBingMap",{current:0,interfaces:[obj]})}a.call(obj)}})};function f(k,m,j){var l=this;l.id=j;l.options=m;l.map=null;l.mapGrabCur=null;l.directionsReady=true;l.pinHome=null;l.pinHomeLayer=null;l.pinLayer=null;l.currentvisiblePinLayer="";l.infoBoxes=[];l.pushpinContinueToShow=true;l.pinInfobox={Active:false,Container:null,Title:null,TitleLabel:null,Body:null,IconBar:null,Timer:null,LastTitleClass:null,Height:215,Width:268};l.shapeMenuTimer=null;l.currentParcelShape=null;l.parcelInfobox={Active:false,Container:null,Id:"parcelInfobox",Title:null,Body:null,HtmlContent:null,LabelArray:[],DataArray:[],Height:126,Width:256,IconBar:null,TitleAction:null,TitleClickHandler:null,visible:false,ArrowLeft:null,ArrowRight:null,ArrowUp:null,ArrowDown:null},l.parcelInfo={};l.docHeight=null;l.docWidth=null;l.searchManager=null;l.poiLayers=null;l.poiInfoBoxes=[];l.parcelConnect="SS";l.parcelLayers=[];l.parcelMinZoom=0;l.parcelMaxZoom=20;l.parcelLineLayer=null;l.parcelLabelLayer=null;l.parcelOption=null;l.tempParcelOption=null;l.parcelLoaded=false;l.trafficLayer=null;l.trafficLayerShown=false;l.postalLayer=null;l.postalLabelLayer=null;l.status={rendered:false,isIE9:false};l.elements={target:k,directionsContainer:null,directionsPicker:null,legend:null};l.directionsManager=null;l.addresses=null;l.driveTime=null;l.driveTimeCallBack=null;l.displayingDirections=false;l.dragHandleModule=null;l.showEditMessage=true;l.editMessageInterval=2500;l.layers={driveTimeLayer:null,parcelInteractionLayer:null,parcelDimensionLayer:null,onMouseClickEventObj:null,onMouseDownEventObj:null,onMouseUpEventObj:null,parcelSelectFillColor:null,parcelSelectLineColor:null,parcelSelectLineThickness:null,parcelClickLocation:null,currentLayerResourceName:null,currentLayerQuery:null,currentLayerId:null};l.drawing={isDrawing:false,imageElement:null,radiusElement:null,distanceElement:null,shapeSummaryElement:null,countElement:null,countContainerElement:null,onClickEventObj:null,onDblClickEventObj:null,onMouseMoveEventObj:null,onMouseDownEventObj:null,onMouseUpEventObj:null,onMouseOutEventObj:null,onMouseOverEventObj:null,onDragHandlesLoaded:null,onShapeMouseClickObj:null,onShapeMouseOverObj:null,onShapeMouseOutObj:null,onImageryChangedEventObj:null,shapeLayer:null,shapeLabelLayer:null,shapeGeomType:null,stopPolygon:null,tempShape:null,tempCircle:null,tempPoints:null,points:[],radius:null,distance:0,tempDistance:0,currentShapeId:1,currentSelectedId:null,mouseOverShapeId:null,currentShape:null,isEditing:false,form:null,skip:true,isIntersected:false,shapeLineColor:null,shapeFillColor:null,highlightShapeLineColor:null,highlightShapeFillColor:null,shapeMouseOverLineColor:null,shapeMouseOverFillColor:null,strokeThickness:null,firstTime:true,shapeArray:[],shapeStore:[],shapesTypes:[{shapeType:"Circle",id:1},{shapeType:"Box",id:2},{shapeType:"Polygon",id:4}],editActive:false,shapeMenu:null};b.extend(l,l.options.jqmApi,{doAlert:function(o){b.jGrowl.defaults.position="bottom-right";b.jGrowl.defaults.glue="before";o.timeout=o.timeout||1500;var n=window;if(l.options.jqm.menuType=="context"){n=l.options.jqm.contextMenuContainer}n.$.jGrowl(o.text,{speed:"slow",life:o.timeout})},newLocation:function(n,o){return new Bing.Location(n,o)},newPoint:function(n,o){return new Bing.Point(n,o)},setMapPointer:function(o){var n=b("#"+l.options.mapDiv).find("div.MicrosoftMap");if(!l.drawing.isDrawing){n.prop("style").cursor="";if(o!=undefined||!(o==="")){n.prop("style").cursor=o}}else{n.prop("style").cursor=l.options.jqmDrawing.drawingCursor}},drawRadius:function(n){var o=parseFloat(n);if(b.isNumeric(o)){l.drawing.points=[];l.drawing.points.push(l.map.getCenter());l.drawing.shapeGeomType="Radius";l.drawing.radius=o;l.drawFinishedShape();l.drawingImageDone()}else{l.doAlert({text:"Please enter a valid Radius in miles."})}},resetImage:function(){b(".imageSelected").removeClass("imageSelected");var n=l.drawing.isDrawing;l.drawing.isDrawing=false;return n},tryLocationToPixel:function(o,n){if(n!=undefined){return l.map.tryLocationToPixel(o,n)}else{return l.map.tryLocationToPixel(o)}},tryPixelToLocation:function(n,o){if(o!=undefined){return l.map.tryPixelToLocation(n,o)}else{return l.map.tryPixelToLocation(n)}},getDistance:function(s,q){p1Lat=u(s.latitude);p1Lon=u(s.longitude);p2Lat=u(q.latitude);p2Lon=u(q.longitude);var t=6371;var p=p2Lat-p1Lat;var v=p2Lon-p1Lon;var o=Math.sin(p/2)*Math.sin(p/2)+Math.cos(p1Lat)*Math.cos(p2Lat)*Math.sin(v/2)*Math.sin(v/2);var n=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));var r=t*n;return(r*0.6214);function u(w){return w*Math.PI/180}},drawingImageClick:function(q){l.drawing.imageElement=q.imageElement;t();var o=l.resetImage();var s=false;if(o){s=true}l.drawing.shapeGeomType=q.shapeGeomType;if(l.drawing.currentSelectedId!=null){l.selectShape(l.drawing.currentSelectedId)}if(!s){var p=l.getNextShapeId();if(p>-1){b(l.drawing.imageElement).addClass("imageSelected");l.drawing.isDrawing=true;if(l.drawing.shapeGeomType==="Radius"){var n=b(l.drawing.imageElement).offset();if(l.drawing.radiusElement.length>0){var u=n.top-l.adjust.top+43;l.drawing.radiusElement.css("top",u+"px").css("left",n.left-l.adjust.left+"px").show();b("#txtRadius").focus()}}if(l.drawing.shapeGeomType==="Locator"){l.doAlert({text:"Click anywhere on the map to set your location.",timeout:4000})}else{if(l.options.jqm.isTouchDevice&&l.drawing.shapeGeomType!="Polygon"){l.doAlert({text:"Touch and drag anywhere on the map to draw your shape.",timeout:4000})}else{l.doAlert({text:"Click anywhere on the map to begin your shape.",timeout:4000})}}r(p)}else{l.doAlert({text:"Warning: You cannot draw more than "+l.options.jqmDrawing.maxNumberShapes+" shapes on the map.  You must delete a shape before you can create a new shape.",timeout:10000});l.drawingImageDone()}}else{l.drawingImageDone()}function t(){if(l.drawing.shapeGeomType==="Polygon"&&l.drawing.stopPolygon!=null){l.drawing.shapeLayer.remove(l.drawing.stopPolygon)}if(l.drawing.tempShape!=null){l.drawing.shapeLayer.remove(l.drawing.tempShape)}if(l.drawing.tempCircle!=null){l.drawing.shapeLayer.remove(l.drawing.tempCircle)}l.drawing.points=[];l.drawing.distance=0;l.drawing.tempDistance=0;l.drawing.customAttr=""}function r(v){l.setMapPointer(l.options.jqmDrawing.drawingCursor);l.drawing.currentShapeId=v;if(l.options.jqm.isTouchDevice){l.drawing.onMouseDownEventObj=Bing.Events.addHandler(l.map,"mousedown",function(B){y.call(l,B)});if(l.drawing.shapeGeomType!="Polygon"){l.drawing.onMouseUpEventObj=Bing.Events.addHandler(l.map,"mouseup",function(B){y.call(l,B)})}}else{var w=l.status.isIE9?"mousedown":"click";l.drawing.onClickEventObj=Bing.Events.addHandler(l.map,w,function(B){y.call(l,B)});l.drawing.onDblClickEventObj=Bing.Events.addHandler(l.map,"dblclick",function(B){x.call(l,B)})}function x(B){y(B);B.handled=true;return false}function y(E){l.setMapPointer(l.options.jqmDrawing.drawingCursor);l.beforeDrawShape.call(l);var H=E.getX();var I=E.getY();var F=new Bing.Point(H,I);var D=l.map.tryPixelToLocation(F);if(l.drawing.points.length==0){if(!(l.drawing.shapeGeomType=="Polygon"&&l.options.jqm.isTouchDevice)){l.drawing.onMouseMoveEventObj=Bing.Events.addHandler(l.map,"mousemove",function(K){z.call(l,K)});if(l.drawing.distanceElement){l.drawing.distanceElement.show()}}}else{if(l.drawing.shapeGeomType=="Polygon"&&l.options.jqm.isTouchDevice){z.call(l,E)}}l.drawing.points.push(D);l.drawing.distance=l.drawing.distance+l.drawing.tempDistance;var J=false;var G=false;if(l.drawing.shapeGeomType==="Rubberband"||l.drawing.shapeGeomType==="Radius"){if(l.drawing.points.length==2){J=true}else{G=true;l.drawing.radiusElement.hide()}}else{if(l.drawing.shapeGeomType==="Polygon"){if(l.drawing.points.length==1){l.drawing.stopPolygon=new Bing.Pushpin(D,{text:" ",icon:"",typeName:"pushPinEndPolygon",width:17,height:15,textOffset:new Bing.Point(0,0)});l.drawing.shapeLayer.push(l.drawing.stopPolygon);b("div.pushPinEndPolygon").attr("title","End Polygon")}if(l.drawing.points.length>2){if(E.target!=null){var B=l.drawing.shapeLayer.indexOf(E.target);if(B>-1){var C=l.drawing.shapeLayer.indexOf(l.drawing.stopPolygon);J=B===C;if(J){l.drawing.points.pop();l.drawing.points.push(l.drawing.points[0])}}}}if(!J){l.drawing.points=A.call(l,l.drawing.points,true);J=l.drawing.isIntersected}}else{if(l.drawing.shapeGeomType==="Locator"){l.setCenter(D);l.drawingImageDone();t();l.pushpinMove(D)}}}if(J){l.drawing.distance=Math.round(l.drawing.distance*10)/10;if(l.drawing.shapeGeomType==="Rubberband"){if(l.options.jqm.isTouchDevice){l.drawing.points=l.drawing.tempPoints}else{pnts=l.drawing.points.slice(0,1);pnts.push(new Bing.Location(l.drawing.points[1].latitude,l.drawing.points[0].longitude));pnts.push(new Bing.Location(l.drawing.points[1].latitude,l.drawing.points[1].longitude));pnts.push(new Bing.Location(l.drawing.points[0].latitude,l.drawing.points[1].longitude));l.drawing.points=pnts}}l.drawing.radius=l.drawing.distance;l.drawFinishedShape();l.drawingImageDone();t()}else{if(G&&!(l.options.jqm.isTouchDevice&&l.drawing.shapeGeomType!="Polygon")){l.doAlert({text:"Click again to end the shape",timeout:4000})}}E.handled=!l.status.isIE9}function z(E){var B=this;B.setMapPointer(B.options.jqmDrawing.drawingCursor);if(B.drawing.shapeGeomType=="Locator"){return;E.handled=B.options.jqm.isTouchDevice}var H=E.getX();var I=E.getY();var F=new Bing.Point(H,I);var C=B.map.tryPixelToLocation(F);B.drawing.tempPoints=B.drawing.points.slice(0,B.drawing.points.length);if(B.drawing.shapeGeomType==="Radius"){B.drawing.skip=!B.drawing.skip;if(B.drawing.skip){return}}if(B.drawing.shapeGeomType==="Radius"&&B.drawing.tempPoints.length==2){B.drawing.tempDistance=B.getDistance(B.drawing.tempPoints[0],C)}else{if(B.drawing.shapeGeomType==="Rubberband"){if(B.drawing.tempPoints.length==1){B.drawing.tempPoints.push(new Bing.Location(C.latitude,B.drawing.tempPoints[0].longitude));B.drawing.tempPoints.push(new Bing.Location(C.latitude,C.longitude));B.drawing.tempPoints.push(new Bing.Location(B.drawing.tempPoints[0].latitude,C.longitude))}else{B.drawing.tempPoints[1](new Bing.Location(C.latitude,B.drawing.tempPoints[0].longitude));B.drawing.tempPoints[2](new Bing.Location(C.latitude,C.longitude));B.drawing.tempPoints[3](new Bing.Location(B.drawing.tempPoints[0].latitude,C.longitude))}B.drawing.tempDistance=(B.getDistance(B.drawing.tempPoints[0],B.drawing.tempPoints[1])+B.getDistance(B.drawing.tempPoints[1],B.drawing.tempPoints[2]))*2}else{B.drawing.tempPoints.push(C);B.drawing.tempDistance=B.getDistance(B.drawing.tempPoints[B.drawing.points.length-1],C)}}if(B.drawing.distanceElement){B.drawing.distanceElement.css("left",E.pageX-B.adjust.left+"px");B.drawing.distanceElement.css("top",(E.pageY-B.adjust.top+20)+"px");B.drawing.distanceElement.html(Math.round((B.drawing.distance+B.drawing.tempDistance)*10)/10+" Miles")}try{B.drawing.shapeLayer.remove(B.drawing.tempShape);B.drawing.shapeLayer.remove(B.drawing.tempCircle)}catch(D){}if(B.drawing.tempPoints.length==2){B.drawing.tempShape=new Bing.Polyline(B.drawing.tempPoints);B.hideIcon();B.drawing.shapeLayer.push(B.drawing.tempShape);if(B.drawing.shapeGeomType==="Radius"){B.drawing.radius=B.drawing.tempDistance;var G=B.getCircle(6);B.drawing.tempCircle=new Bing.Polygon(G,{fillColor:B.drawing.shapeFillColor,strokeColor:B.drawing.shapeLineColor,strokeThickness:B.drawing.strokeThickness});B.hideIcon();B.drawing.shapeLayer.push(B.drawing.tempCircle)}}else{if(B.drawing.shapeGeomType==="Rubberband"){B.drawing.tempPoints.push(B.drawing.tempPoints[0]);B.drawing.tempShape=new Bing.Polygon(B.drawing.tempPoints,{fillColor:B.drawing.shapeFillColor,strokeColor:B.drawing.shapeLineColor,strokeThickness:B.drawing.strokeThickness})}}if(B.drawing.tempPoints.length>2){switch(B.drawing.shapeGeomType){case"Polygon":B.drawing.tempPoints=A.call(B,B.drawing.tempPoints);B.drawing.tempShape=new Bing.Polygon(B.drawing.tempPoints,{fillColor:B.drawing.shapeFillColor,strokeColor:B.drawing.shapeLineColor,strokeThickness:B.drawing.strokeThickness});break}B.hideIcon();B.drawing.shapeLayer.push(B.drawing.tempShape)}E.handled=true}function A(G,J){l.drawing.isIntersected=false;var M=G.length;if(M>=3){var C=G[M-2].latitude;var K=G[M-2].longitude;var D=G[M-1].latitude;var L=G[M-1].longitude;if(J&&M==(l.options.jqmDrawing.maxNumberPolyPoints-1)){l.doAlert({text:"Warning: You have reach reached "+(l.options.jqmDrawing.maxNumberPolyPoints-1)+" points (Max "+l.options.jqmDrawing.maxNumberPolyPoints+").  After the next point the Polygon will automatically complete.",timeout:8000})}else{if(J&&M>=l.options.jqmDrawing.maxNumberPolyPoints){l.drawing.isIntersected=true;G.pop();G.push(G[0]);return G}}for(var N=0;N<M-3;N++){var E=G[N].latitude;var F=G[N].longitude;var H=G[N+1].latitude;var I=G[N+1].longitude;if(B(E,F,H,I,C,K,D,L)){l.drawing.isIntersected=true;G.pop();G.push(G[0]);return G}}}return G;function B(U,V,W,X,aa,ab,Q,R){var S=W-U;var P=aa-Q;var Z=(X-V)/S;var O=(ab-R)/P;var Y,T;if(S==0){Y=U;T=O*(U-Q)+R}else{if(P==0){Y=Q;T=Z*(Q-U)+V}else{Y=(-O*Q+R+Z*U-V)/(Z-O);T=Z*(Y-U)+V}}return(ac(Y,T,U,V,W,X)&&ac(Y,T,aa,ab,Q,R));function ac(ag,ae,ai,ad,af,ah){return(ag<=Math.max(ai,af)&&ag>=Math.min(ai,af)&&ae<=Math.max(ad,ah)&&ae>=Math.min(ad,ah))}}}}},drawShapes:function(n){if(!l.drawing.shapeLayer){l.initShapeLayer()}if(n!=null&&n.length>0){b.each(n,function(p,o){l.drawing.currentShapeId=l.getNextShapeId();l.drawing.points=o.points;l.drawing.shapeGeomType=o.shapeType==4?"Polygon":o.shapeType==1?"Radius":"Rubberband";l.drawing.radius=o.radius;l.drawing.customAttr=o.customAttr;l.drawFinishedShape(true,o.lineColor,o.fillColor);if(o.exclude){l.toggleShapeExclusion("chkExclude_"+l.drawing.currentShapeId)}});l.addedShape.call(l)}},drawFinishedShape:function(t,s,A){if(!A){A=l.drawing.shapeFillColor}if(!s){s=l.drawing.shapeLineColor}var n=l.drawing.shapeGeomType;if(l.drawing.shapeGeomType=="Rubberband"){n=l.options.jqmMenu.rubberbandName}n+=" Shape "+(l.drawing.currentShapeId+1);switch(l.drawing.shapeGeomType){case"Polygon":l.drawing.currentShape=new Bing.Polygon(l.drawing.points,{fillColor:A,strokeColor:s,strokeThickness:l.drawing.strokeThickness});b(l.drawing.currentShape).attr("id","shape_"+l.drawing.currentShapeId);w(n);break;case"Rubberband":l.drawing.points.push(l.drawing.points[0]);l.drawing.currentShape=new Bing.Polygon(l.drawing.points,{fillColor:A,strokeColor:s,strokeThickness:l.drawing.strokeThickness});b(l.drawing.currentShape).attr("id","shape_"+l.drawing.currentShapeId);x(n);break;case"Radius":var o=l.getCircle(6);l.drawing.currentShape=new Bing.Polygon(o,{fillColor:A,strokeColor:s,strokeThickness:l.drawing.strokeThickness});b(l.drawing.currentShape).attr("id","shape_"+l.drawing.currentShapeId);r(n);break}l.hideIcon();l.drawing.shapeLayer.push(l.drawing.currentShape);if(l.options.jqmDrawing.allowShapeEdit){l.drawing.onShapeMouseClickObj=Bing.Events.addHandler(l.drawing.currentShape,"click",l.shapeClick);l.drawing.onShapeMouseOverObj=Bing.Events.addHandler(l.drawing.currentShape,"mouseover",l.shapeMouseOver);l.drawing.onShapeMouseOutObj=Bing.Events.addHandler(l.drawing.currentShape,"mouseout",l.shapeMouseOut)}if(l.options.jqmDrawing.displayShapeLabel){y()}if(l.options.jqmDrawing.useShapeMenu){v()}l.drawing.shapeArray[l.drawing.currentShapeId]=true;if(l.options.jqmMenu.showShapeSummary){l.drawing.shapeSummaryElement.show();var q=b('<div class="shapeSummaryItemBase shapeSummaryItemNormal" id="shapeSummaryItem_'+l.drawing.currentShapeId+'" rel="'+l.drawing.currentShapeId+'" title="Click to Edit the shape">').mouseover(function(C){l.shapeMouseOver(C)}).mouseout(function(C){l.startShapeMenuTimer()}).appendTo(b("#divShapes"));b('<div class="shapeSummaryImg" title="Click to remove shape." />').appendTo(q).click(function(){l.deleteShape(b(this).parent().attr("rel"),this)});if(l.options.jqmMenu.showExcludeOnShapeSummary){var p=b('<div class="shapeSummaryExclude"></div>');p.appendTo(q);var B=b('<input type="checkbox" id="chkExclude_'+l.drawing.currentShapeId+'"/>').mouseover(function(C){l.shapeMouseOver(C)}).mouseout(function(C){l.startShapeMenuTimer()}).appendTo(p);b('<label for="chkExclude_'+l.drawing.currentShapeId+'" title="Click to exclude this shape\'s area from your search.">In</label>').appendTo(p);B.button().click(function(C){C.preventDefault();l.toggleShapeExclusion(b(this).attr("id"),b(this));C.handled=true;return false})}b('<div class="shapeSummaryDesc" id="shapeDesc_'+l.drawing.currentShapeId+'" >'+n+"</div>").mouseover(function(C){l.shapeMouseOver(C)}).mouseout(function(C){l.startShapeMenuTimer()}).appendTo(q).click(function(){l.selectShape(b(this).parent().attr("rel"),b(this).parent())})}if(!t){l.addedShape.call(l)}function y(){l.drawing.shapeLabelLayer=l.getPinLayerByName("shapeLabel");var D=Microsoft.Maps.LocationRect.fromLocations(l.drawing.currentShape.getLocations());var E=l.tryLocationToPixel(new Bing.Location(D.getNorth(),D.getEast()));E.x=E.x+l.options.jqm.pinWidth;E.y=E.y+(l.options.jqm.pinHeight/2);var G=new Bing.Pushpin(l.tryPixelToLocation(E),{text:(l.drawing.currentShapeId+1).toString(),icon:"",width:l.options.jqm.pinWidth,height:l.options.jqm.pinHeight,typeName:"shapeLabel",textOffset:new Bing.Point(0,3)});G.id="shapeLabel_"+l.drawing.currentShapeId;G._id=G.id;var C=Bing.Events.addHandler(G,"click",l.shapeLabelClicked);var H=Bing.Events.addHandler(G,"mouseover",l.shapeMouseOver);var F=Bing.Events.addHandler(G,"mouseout",l.startShapeMenuTimer);l.drawing.shapeLabelLayer.push(G);b(".shapeLabel div").css("color","#00008B")}function v(){if(l.drawing.shapeMenu==null){l.drawing.shapeMenu=b('<div class="jqmShapeMenu"></div>').mouseover(function(F){b(this).show();F.target.id="shape_"+l.drawing.mouseOverShapeId;l.shapeMouseOver(F)}).mouseout(function(){if(!l.drawing.isEditing){b(this).hide()}l.startShapeMenuTimer()});l.drawing.shapeMenu.appendTo(l.elements.target.parent());l.drawing.shapeMenu.append('<a class="jqmShapeMenuClose" href="#" onclick="$(this).parent().hide();" >X</a>');var C=b('<div class="shapeMenuButton shapeMenuDelete" ></div>').click(function(){var F=l.drawing.mouseOverShapeId;l.deleteShape(F);b(this).parent().hide()});l.drawing.shapeMenu.append(C);var E=b('<div class="shapeMenuButton shapeMenuExclude" ></div>').mouseover(function(){var G=l.drawing.mouseOverShapeId;b(this).css("background-position","");var F=l.drawing.shapeStore[G].exclude?"0px -45px":"0px -15px";b(this).css("background-position",F)}).mouseout(function(){var G=l.drawing.mouseOverShapeId;b(this).css("background-position","");var F=l.drawing.shapeStore[G].exclude?"0px -30px":"0px 0px";b(this).css("background-position",F)}).click(function(){var G=l.drawing.mouseOverShapeId;l.toggleShapeExclusion("chkExclude_"+G);var F=l.drawing.shapeStore[G].exclude?"0px -45px":"0px -15px";b(this).css("background-position",F)});l.drawing.shapeMenu.append(E);var D=b('<div class="shapeMenuButton shapeMenuEdit" ></div>').mouseover(function(){var F=l.drawing.isEditing?"0px -45px":"0px -15px";b(this).css("background-position",F)}).mouseout(function(){var F=l.drawing.isEditing?"0px -30px":"0px 0px";b(this).css("background-position",F)}).click(function(){var G=l.drawing.mouseOverShapeId;l.selectShape(G,b("div#shapeSummaryItem_"+G));var F=l.drawing.isEditing?"0px -45px":"0px -15px";b(this).css("background-position",F)});l.drawing.shapeMenu.append(D);l.drawing.shapeMenu.hide()}}function z(C){l.drawing.shapeStore[l.drawing.currentShapeId]=C;if(l.options.jqmDrawing.createDrawingHiddenElements){var E=JSON.stringify(C);if(l.drawing.form==null){form=b("form:first")}var D='<input type="hidden" name="Shape'+l.drawing.currentShapeId+'" id="hdnShape'+l.drawing.currentShapeId+'"/>';b(D).appendTo(form).val(E)}}function u(C){var D=null;b.each(l.drawing.shapesTypes,function(F,E){if(this.shapeType===C){D=this.id;return false}});return D}function w(D){var C={};C.id=l.drawing.currentShapeId;C.shapeType=u("Polygon");C.points=l.drawing.points;C.description=D;C.customAttr=l.drawing.customAttr;C.exclude=false;z(C)}function r(D){var C={};C.id=l.drawing.currentShapeId;C.shapeType=u("Circle");C.radius=l.drawing.radius;C.points=l.drawing.points;C.description=D;C.customAttr=l.drawing.customAttr;C.exclude=false;z(C)}function x(D,C,E){var F={};F.id=l.drawing.currentShapeId;F.shapeType=u("Box");F.points=l.drawing.points;F.description=D;F.customAttr=l.drawing.customAttr;F.exclude=false;z(F)}},getCircle:function(r){var u=[];var n=l.drawing.radius/0.6214;var v=6371;var t=(l.drawing.points[0].latitude*Math.PI)/180;var q=(l.drawing.points[0].longitude*Math.PI)/180;var p=parseFloat(n)/v;r=r==null?1:r;for(var w=0;w<=360;w+=r){var o=new Bing.Location(0,0);var s=w*Math.PI/180;o.latitude=Math.asin(Math.sin(t)*Math.cos(p)+Math.cos(t)*Math.sin(p)*Math.cos(s));o.longitude=((q+Math.atan2(Math.sin(s)*Math.sin(p)*Math.cos(t),Math.cos(p)-Math.sin(t)*Math.sin(o.latitude)))*180)/Math.PI;o.latitude=(o.latitude*180)/Math.PI;u.push(o)}return u},drawingImageDone:function(){if(l.drawing.radiusElement){l.drawing.radiusElement.hide()}if(l.drawing.onMouseMoveEventObj!=null){Bing.Events.removeHandler(l.drawing.onMouseMoveEventObj)}if(l.drawing.onMouseUpEventObj!=null){Bing.Events.removeHandler(l.drawing.onMouseUpEventObj)}if(l.drawing.onMouseDownEventObj!=null){Bing.Events.removeHandler(l.drawing.onMouseDownEventObj)}if(l.drawing.onClickEventObj!=null){Bing.Events.removeHandler(l.drawing.onClickEventObj)}if(l.drawing.onDblClickEventObj!=null){Bing.Events.removeHandler(l.drawing.onDblClickEventObj)}l.resetImage();if(l.drawing.distanceElement){l.drawing.distanceElement.hide()}},initShapeLayer:function(){l.setupDrawingColors();l.drawing.shapeLayer=new Bing.EntityCollection();l.map.entities.push(l.drawing.shapeLayer);Bing.Events.addHandler(l.map,"click",function(n){l.mapClick(n)})},setupDrawingColors:function(){var n=l.options.jqmDrawing.shapeLineColor;l.drawing.shapeLineColor=new Bing.Color(n.o,n.r,n.g,n.b);n=l.options.jqmDrawing.shapeFillColor;l.drawing.shapeFillColor=new Bing.Color(n.o,n.r,n.g,n.b);n=l.options.jqmDrawing.highlightShapeLineColor;l.drawing.highlightShapeLineColor=new Bing.Color(n.o,n.r,n.g,n.b);n=l.options.jqmDrawing.highlightShapeFillColor;l.drawing.highlightShapeFillColor=new Bing.Color(n.o,n.r,n.g,n.b);n=l.options.jqmDrawing.excludeShapeLineColor;l.drawing.excludeShapeLineColor=new Bing.Color(n.o,n.r,n.g,n.b);n=l.options.jqmDrawing.excludeShapeFillColor;l.drawing.excludeShapeFillColor=new Bing.Color(n.o,n.r,n.g,n.b);n=l.options.jqmDrawing.shapeMouseOverLineColor;l.drawing.shapeMouseOverLineColor=new Bing.Color(n.o,n.r,n.g,n.b);n=l.options.jqmDrawing.shapeMouseOverFillColor;l.drawing.shapeMouseOverFillColor=new Bing.Color(n.o,n.r,n.g,n.b);l.drawing.strokeThickness=l.options.jqmDrawing.strokeThickness},selectShape:function(n,p){l.setMapPointer(l.options.jqmDrawing.shapeHoverCursor);b("#shapeLabel_"+n+" div").css("color","#00008B");if(l.options.jqmDrawing.useShapeMenu){l.drawing.shapeMenu.show()}if(l.dragHandleModule!=null){l.dragHandleModule.dispose()}var v=null;for(var t=0;t<l.drawing.shapeLayer.getLength();t++){v=l.drawing.shapeLayer.get(t);if(v){var u=l.drawing.shapeStore[v.id.substring(v.id.indexOf("_")+1)];if(u.exclude){v.setOptions({fillColor:l.drawing.excludeShapeFillColor,strokeColor:l.drawing.excludeShapeLineColor})}else{v.setOptions({fillColor:l.drawing.shapeFillColor,strokeColor:l.drawing.shapeLineColor,strokeThickness:l.drawing.strokeThickness})}if(l.drawing.onMouseDownEventObj!=null){Bing.Events.removeHandler(l.drawing.onMouseDownEventObj);l.drawing.onMouseDownEventObj=null}if(l.drawing.onMouseMoveEventObj!=null){Bing.Events.removeHandler(l.drawing.onMouseMoveEventObj);l.drawing.onMouseMoveEventObj=null}if(l.drawing.onMouseUpEventObj!=null){Bing.Events.removeHandler(l.drawing.onMouseUpEventObj);l.drawing.onMouseUpEventObj=null}if(l.drawing.onMouseOutEventObj!=null){Bing.Events.removeHandler(l.drawing.onMouseOutEventObj);l.drawing.onMouseOutEventObj=null}if(l.drawing.onMouseOverEventObj!=null){Bing.Events.removeHandler(l.drawing.onMouseOverEventObj);l.drawing.onMouseOverEventObj=null}}}b(".shapeSummaryItemSelected").addClass("shapeSummaryItemNormal").removeClass("shapeSummaryItemSelected");l.drawing.isEditing=false;if(l.drawing.currentSelectedId==n){l.drawing.currentSelectedId=null;if(l.options.jqmDrawing.useShapeMenu){b(l.drawing.shapeMenu).find(".shapeMenuEdit").css("background-position","0px 0px");l.drawing.shapeMenu.hide()}return}v=l.drawing.shapeLayer.get(l.getShapeLayerId(n));if(!v){l.drawing.shapeMenu.hide();return false}l.drawing.currentSelectedId=l.drawing.currentShapeId=n;if(l.options.jqmDrawing.allowShapeEdit){o(v,n);l.drawing.isEditing=true;if(l.options.jqmDrawing.useShapeMenu){b(l.drawing.shapeMenu).find(".shapeMenuEdit").css("background-position","0px -30px")}}var r=l.drawing.shapeStore[n].exclude;v.setOptions({fillColor:l.drawing.highlightShapeFillColor,strokeColor:r?l.drawing.excludeShapeLineColor:l.drawing.highlightShapeLineColor});b(p).removeClass("shapeSummaryItemNormal").addClass("shapeSummaryItemSelected");l.positionShapeMenu(n);var q=r?"0px -30px":"0px 0px";b(l.drawing.shapeMenu).find(".shapeMenuExclude").css("background-position",q);l.selectedShape.call(l);function o(){if(l.dragHandleModule==null){l.drawing.onDragHandlesLoaded=function(){l.dragHandleModule=new dragHandleModule(l.map,{DragHandleImage:b.fn.jqBingMapSrc+"/themes/"+l.options.jqm.controlTheme+"/DragHandleWhite.gif?"+l.options.jqm.scriptVersion,DragHandleImageActive:b.fn.jqBingMapSrc+"/themes/"+l.options.jqm.controlTheme+"/DragHandleGreen.gif?"+l.options.jqm.scriptVersion,MoveShapeImage:b.fn.jqBingMapSrc+"/themes/"+l.options.jqm.controlTheme+"/MoveShapeWhite.gif?"+l.options.jqm.scriptVersion,MoveShapeImageActive:b.fn.jqBingMapSrc+"/themes/"+l.options.jqm.controlTheme+"/MoveShapeGreen.gif?"+l.options.jqm.scriptVersion,AddHandleImage:b.fn.jqBingMapSrc+"/themes/"+l.options.jqm.controlTheme+"/AddHandleWhite.gif?"+l.options.jqm.scriptVersion,AddHandleImageActive:b.fn.jqBingMapSrc+"/themes/"+l.options.jqm.controlTheme+"/AddHandleGreen.gif?"+l.options.jqm.scriptVersion,beforeEdit:function(){l.beforeEditShape.call(l)},afterEdit:function(){var x=l.drawing.shapeLayer.get(l.getShapeLayerId(l.drawing.currentSelectedId));var y=l.drawing.shapeStore[l.drawing.currentSelectedId];if(y.shapeType==1){var w=x.getLocations();y.radius=l.getDistance(w[0],l.dragHandleModule.shapeCenter());y.points[0]=l.dragHandleModule.shapeCenter()}else{y.points=x.getLocations()}l.drawing.shapeStore[l.drawing.currentSelectedId]=y;if(l.options.jqmDrawing.createDrawingHiddenElements){var z=JSON.stringify(y);if(l.drawing.form==null){form=b("form:first")}b("#hdnShape"+l.drawing.currentSelectedId).val(z)}l.afterEditShape.call(l)}});s(v)};Bing.registerModule("DragHandles",b.fn.jqBingMapSrc+"/DragHandleModule.min.js?"+l.options.jqm.scriptVersion);Bing.loadModule("DragHandles",{callback:l.drawing.onDragHandlesLoaded})}else{s(v)}}function s(x){var w=x.id.replace("shape_","");var y=l.drawing.shapeStore[w].shapeType;if(l.dragHandleModule!=null){if(l.options.jqmDrawing.useShapeMenu){l.dragHandleModule.setDivToUpdate(l.drawing.shapeMenu,"right")}if(l.options.jqmDrawing.displayShapeLabel){l.dragHandleModule.setPushPinToUpdate(l.drawing.shapeLabelLayer.get(w),"right")}l.dragHandleModule.edit(x,y)}}},clickInsideShape:function(n,r){var o=false;if(r==null){return o}var q=r.length-1;for(var p=0;p<r.length-1;p++){if(r[p].longitude<n.longitude&&r[q].longitude>=n.longitude||r[q].longitude<n.longitude&&r[p].longitude>=n.longitude){if(r[p].latitude+(n.longitude-r[p].longitude)/(r[q].longitude-r[p].longitude)*(r[q].latitude-r[p].latitude)<n.latitude){o=!o}}q=p}return o},updateShapeExternalObjects:function(){if(l.options.jqmDrawing.useShapeMenu||l.options.jqmDrawing.displayShapeLabel){if(l.drawing.shapeLayer.getLength()>0){for(var o=0;o<l.drawing.shapeLayer.getLength();o++){var r=l.drawing.shapeLayer.get(o);var n=Microsoft.Maps.LocationRect.fromLocations(r.getLocations());var p=l.tryLocationToPixel(new Bing.Location(n.getNorth(),n.getEast()));p.x=p.x+l.options.jqm.pinWidth;p.y=p.y+(l.options.jqm.pinHeight/2);if(l.drawing.shapeLabelLayer!=null){var q=l.drawing.shapeLabelLayer.get(o);q.setLocation(l.tryPixelToLocation(p));b(".shapeLabel div").css("color","#00008B")}if(!l.options.jqmDrawing.useShapeMenu){continue}if(l.drawing.currentSelectedId!=null&&l.drawing.currentSelectedId==o){l.positionShapeMenu(o)}}}}},getMapBounds:function(){return l.map.getBounds()},hideIcon:function(){},getShapeCount:function(){var n=0;for(var o=0;o<l.drawing.shapeArray.length;o++){if(l.drawing.shapeArray[o]){n++}}return n},getNextShapeId:function(){var n=0;for(var o=0;o<l.drawing.shapeArray.length;o++){if(!l.drawing.shapeArray[o]&&n<l.options.jqmDrawing.maxNumberShapes){return o}else{n++}}return n<l.options.jqmDrawing.maxNumberShapes?n:-1},getShapeInfo:function(){return l.drawing.shapeStore},getShapeElements:function(n){if(l.drawing.form==null){form=b("form:first")}var o=b(form).find("input[id^=hdnShape]");if(n&&o.length>0){return b("#hdnShape"+n)}return o},getShapeLayerId:function(o){var p=null;for(var q=0;q<l.drawing.shapeLayer.getLength();q++){var n=l.drawing.shapeLayer.get(q);if(b(n).attr("id")==="shape_"+o){p=q;break}}return p},deleteShape:function(n,q){if(!q){q=b("#shapeSummaryItem_"+n+" div.shapeSummaryImg")}l.drawing.shapeLayer.removeAt(l.getShapeLayerId(n));l.drawing.shapeArray[n]=false;var s=b(q).parent().parent().children();var p=s.length;b(q).parent().remove();l.drawing.shapeStore[n]=null;if(l.options.jqmDrawing.createDrawingHiddenElements){var t=b("#hdnShape"+n);if(t.length>0){t.remove()}}if(l.drawing.shapeLabelLayer!=null&&(l.options.jqmDrawing.displayShapeLabel||l.options.jqmDrawing.useShapeMenu)){for(var o=0;o<l.drawing.shapeLabelLayer.getLength();o++){var r=l.drawing.shapeLabelLayer.get(o);if(b(r).attr("id")=="shapeLabel_"+n){l.drawing.shapeLabelLayer.removeAt(o)}}l.drawing.shapeMenu.hide()}if(l.dragHandleModule!=null){l.dragHandleModule.dispose()}if(p<=1&&l.options.jqmMenu.showShapeSummary){l.drawing.shapeSummaryElement.hide();l.drawing.countElement.html("");l.drawing.countContainerElement.hide()}l.deletedShape.call(l)},toggleShapeExclusion:function(v,p){var n=v.split("_")[1];var w=!l.drawing.shapeStore[n].exclude;l.drawing.shapeStore[n].exclude=w;if(l.options.jqmMenu.showShapeSummary){var s=b('label[for="'+v+'"]');var y="In";var u="Click to exclude this shape's area from your search.";if(w){y="Ex";u="Click to include this shape's area in your search.";s.addClass("ui-state-active")}else{s.removeClass("ui-state-active")}s.find("span").text(y);s.attr("title",u)}var x=l.drawing.shapeLayer.get(l.getShapeLayerId(n));if(!x){return false}var r=l.drawing.currentSelectedId==n;var q=w?l.drawing.excludeShapeFillColor:l.drawing.shapeFillColor;var o=w?l.drawing.excludeShapeLineColor:l.drawing.shapeLineColor;if(r){q=l.drawing.highlightShapeFillColor;if(!w){o=l.drawing.highlightShapeLineColor}}x.setOptions({fillColor:q,strokeColor:o});if(l.options.jqmDrawing.createDrawingHiddenElements){var t=JSON.stringify(l.drawing.shapeStore[n]);if(l.drawing.form==null){form=b("form:first")}b("#hdnShape"+n).val(t)}l.afterEditShape.call(l)},resizeMap:function(p){if(l.displayingDirections){return}if(l.options.jqm.fitToWindow){l.docHeight=b(window).height();l.docWidth=b(window).width()}else{l.docHeight=b("#"+l.options.mapDiv).height();l.docWidth=b("#"+l.options.mapDiv).width()}if(!p){p={height:l.docHeight-(l.options.jqm.topOffset||0),width:l.docWidth-(l.options.jqm.leftOffset||0)}}l.elements.target.css(p);if(l.map){l.map.setOptions(p)}window.setTimeout(function(){l.positionDockMenu()},100);if(l.options.jqmMenu.showShapeSummary){var q=l.docWidth-(l.options.jqm.leftOffset||0)-l.adjust.left-197;l.drawing.shapeSummaryElement.css("left",q);var o=l.drawing.shapeSummaryElement.width();var s=l.drawing.countContainerElement.width();var r=(o-s)/2;var n=q+r;l.drawing.countContainerElement.css({left:n+"px"})}},setCenter:function(o,n){if(o.latitude){l.options.center=o;l.options.bounds=null;if(n){l.options.zoom=n}}else{if(l.options.jqm.locations.length==1){l.options.center=l.options.jqm.locations[0];l.options.bounds=null}else{if(l.options.jqm.locations.length>1){l.options.bounds=l.getMapViewBoundardies(l.options.jqm.locations);l.options.center=null}}}if(!l.map){Bing.loadModule("Microsoft.Maps.Overlays.Style",{callback:function(){l.map=new Bing.Map(l.elements.target.get(0),l.options);if(l.options.jqm.showCenterImage){l.setCenterImage(o)}e.call(l)}})}else{l.map.setView(m);if(l.options.jqm.showCenterImage){l.setCenterImage(o)}}},pushpinDragged:function(n){var o=n.entity.getLocation();l.pushpinMove(o)},pushpinMove:function(n){l.pushpinMoved.call(l,n)},setCenterImage:function(n){var o=new Bing.Location(n.latitude,n.longitude);if(l.options.jqmMenu.showLocator){l.pinHome=new Bing.Pushpin(o,{draggable:true,textOffset:new Bing.Point(0,0)});Bing.Events.addHandler(l.pinHome,"dragend",l.pushpinDragged)}else{l.pinHome=new Bing.Pushpin(o,{text:"",icon:"",width:16,height:16,typeName:"pinHome",textOffset:new Bing.Point(0,0)})}if(!l.pinHomeLayer){l.pinHomeLayer=new Bing.EntityCollection();l.map.entities.push(l.pinHomeLayer)}else{l.pinHomeLayer.clear()}l.pinHomeLayer.push(l.pinHome)},isPinLayerVisible:function(n){var o=l.getPinLayerByName(n);return o.getVisible()},setPinLayerVisible:function(o,p){var n=l.getPinLayerByName(p);n.setOptions({visible:o})},getPinLayerByName:function(r){var p=null;for(var q=0;q<l.map.entities.getLength();q++){var o=l.map.entities.get(q);if(typeof(o.jqmLayerName)!=undefined&&(typeof(o.jqmLayerType)!=undefined&&o.jqmLayerType==="pin")&&(r!=undefined&&o.jqmLayerName==r||r==undefined&&o.jqmLayerName=="Default")){p=o}}if(!p){p=new Bing.EntityCollection();p.jqmLayerName=r||"Default";p.jqmLayerType="pin";l.map.entities.push(p);if(l.options.jqmMenu.showPinLayerPicker){var n=b("div#pinLayers");var s=b('<div groupId="0" rel="'+p.jqmLayerName+'" class="ui-corner-all pinItem pinItemSelected"/>').appendTo(n).click(function(){l.togglePinLayerItem.call(l,b(this).attr("rel"))});b('<div class="pinItemDesc">'+p.jqmLayerName+"</div>").appendTo(s)}}return p},hideAllPinLayers:function(){var o=l.currentvisiblePinLayer.length>0;for(var n=0;n<l.map.entities.getLength();n++){var p=l.map.entities.get(n);if(typeof(p.jqmLayerName)!=undefined&&(typeof(p.jqmLayerType)!=undefined&&p.jqmLayerType==="pin")&&p.getVisible()){l.currentvisiblePinLayer+=(o?",":"")+p.jqmLayerName;p.setOptions({visible:false});o=true}}},showPreviousPinLayer:function(){var n=l.currentvisiblePinLayer.split(",");b.each(n,function(p,o){l.setPinLayerVisible(true,o)});l.currentvisiblePinLayer=""},addPins:function(o,s){if(o==undefined||o.length<1){return}var n=null;var q=false;var p=l.getPinLayerByName(s);l.options.jqm.locations=o;var r=0;b.each(o,function(y,v){r++;var w=new Bing.Location(v.latitude,v.longitude);var t=" ";if(l.options.jqm.displayPinText){t=v.text!=undefined?v.text.toString():r.toString()}var x=new Bing.Pushpin(w,{text:t,icon:"",width:l.options.jqm.pinWidth,height:l.options.jqm.pinHeight,typeName:v.pinClass,textOffset:new Bing.Point(l.options.jqm.pinTextOffsetX,l.options.jqm.pinTextOffsetY)});x._id="pin_"+(v.ID||r);var z=Bing.Events.addHandler(x,"click",l.pushpinClicked);var A=Bing.Events.addHandler(x,"mouseover",l.pushpinMouseovered);var u=Bing.Events.addHandler(x,"mouseout",l.pushpinMouseouted);if(v.InfoBoxTitle){infoBoxData={InfoBoxTitle:v.InfoBoxTitle,InfoBoxTitleClass:v.InfoBoxTitleClass,Thumbnail:v.Thumbnail,InfoBoxLabels:v.InfoBoxLabels,InfoBoxData:v.InfoBoxData,pin:x};l.infoBoxes[(v.ID||r)]=infoBoxData}p.push(x)})},displayInfobox:function(o,n){l.stopInfoboxTimer();var p=o.target;l.displayInfoboxByPin(p,false,n)},displayInfoboxByPinId:function(p,n){l.stopInfoboxTimer();if(p.indexOf("pin_")>=0){p=p.replace("pin_","")}var o={};o.ID=p;l.displayInfoboxByPin(o,true,n)},displayInfoboxByPin:function(p,o,n){l.stopInfoboxTimer();setTimeout(function(){if(l.pushpinContinueToShow||l.options.jqm.pinInfoBoxDelay==0||o){q(p,n)}},l.options.jqm.pinInfoBoxDelay);function q(w,G){if(w!=null){var z="";var A=null;var r=null;if(w.ID!=undefined){A=l.infoBoxes[w.ID];l.pinInfobox.IconBar.attr("rel",w.ID).show()}else{if(w._id.match("^pin")=="pin"){var v=w._id.replace("pin_","");A=l.infoBoxes[v];l.pinInfobox.IconBar.attr("rel",v).show()}else{var J=w._id.split("_");A=l.poiInfoBoxes[J[1]][J[2]];l.pinInfobox.IconBar.hide()}}if(G){l.pinInfobox.IconBar.hide()}if(A!=null){if(w._id!=undefined){r=w._id.replace("pin_","")}if(w.ID!=undefined){r=w.ID}if(G){z=l.onSetPushpinHtmlForMini.call(l,r)}if(z.length==0){z=l.onSetPushpinHtml.call(l,r)}if(z.length==0){var C=(G)?A.InfoBoxLabels.length-1:A.InfoBoxLabels.length;z='<table><tr><td rowspan="'+(C+1)+'">';if(A.Thumbnail){z+='<img src="'+A.Thumbnail+'"/>'}z+="</td></tr>";for(var H=0;H<C;H++){z+='<tr><td class="pushpinPopupLabel">'+A.InfoBoxLabels[H]+"</td><td>"+A.InfoBoxData[H]+"</td></tr>"}z+="</table>"}if(A.InfoBoxTitleClass!=l.pinInfobox.LastTitleClass){l.pinInfobox.Title.removeClass(l.pinInfobox.LastTitleClass).addClass(A.InfoBoxTitleClass);l.pinInfobox.LastTitleClass=A.InfoBoxTitleClass}l.pinInfobox.TitleLabel.html(A.InfoBoxTitle);l.pinInfobox.Body.html(z);var I=(w.ID!=undefined)?b("#pin_"+w.ID):b("#"+w._id);if(I.length==0){return}var D=I.offset();var s=l.elements.target.offset();var F=D.left-l.adjust.left;var E=D.top-l.adjust.top;var t=31;var u=b("div.pushpinPopupArrowRight").width();var K=b("div.pushpinPopupArrowRight").height();var B=b("div.pushpinPopup");if(G){B.height(l.pinInfobox.Height*(l.options.jqm.miniInfoBoxScale/10))}else{B.css("height","")}var x=b("div.pushpinPopup").width();F+=u+I.width();E=E-t;if(E+B.height()>l.docHeight){E=E-B.height()+t+I.height();t=B.height()-K}else{if(E<0){E=0;t=0}}var y=true;if(F+x>l.docWidth){F=F-x-(u*2)-I.width();y=false}else{if(F<0){F=0}}if(y){b("div.pushpinPopupArrowLeft").show().css("top",t+"px");b("div.pushpinPopupArrowRight").hide()}else{b("div.pushpinPopupArrowLeft").hide();b("div.pushpinPopupArrowRight").show().css("top",t+"px")}l.pinInfobox.Active=true;l.pinInfobox.Container.css({left:F,top:E}).show()}}}},hideInfobox:function(){l.pinInfobox.Active=false;l.pinInfobox.Container.hide()},zoomToParcel:function(){var o=Bing.LocationRect.fromLocations(l.currentParcelShape.getLocations());var n=l.map.getOptions();n.bounds=o;n.padding=12;l.map.setView(n)},hideParcelInfobox:function(){l.parcelInfobox.Active=false;l.parcelInfobox.Container.fadeOut("slow")},showParcelInfobox:function(){var r=l.options.jqmLayer.parcelInfobox;var v=b("<div></div>");if(typeof(r.title)=="string"){var w=(r.title!=null&&r.title.length>0)?r.title:"";var q=b('<div class="label">'+w+"</div>");if(typeof(r.titleClickHandler)=="function"){var y=b("<a>"+w+"</a>").click(function(F){F.preventDefault();r.titleClickHandler.call(l,l.parcelInfo.Apn,l.parcelInfo.Fips)});q.html(y)}v.append(q);if(r.titleActionItem!=null&&r.titleActionItem.length>0){v.append(b('<div class="jqmPrclInfbxtitleAction"></div>').append(r.titleActionItem))}var x=b('<div class="close" >X</div>').click(function(){b("div."+r.CssClass).hide()});v.append(x);l.parcelInfobox.Title.html(v)}else{l.parcelInfobox.Title.html(r.title)}l.parcelInfobox.Body.html("");if(r.addApn&&typeof(l.parcelInfo.Apn)!="undefined"){var p=l.parcelInfo.Apn!=""?l.parcelInfo.Apn:"unavailable";l.parcelInfobox.Body.append(b("<div><label>APN #:</label> "+p+"</div>"))}if(r.addFips&&typeof(l.parcelInfo.Fips)!="undefined"){var u=l.parcelInfo.Fips!=""?l.parcelInfo.Fips:"unavailable";l.parcelInfobox.Body.append(b("<div><label>FIPs #:</label> "+u+"</div>"))}if(l.parcelInfobox.LabelArray!=null&&l.parcelInfobox.LabelArray.length>0){var D=b("<table></table>");for(var A=0;A<l.parcelInfobox.LabelArray.length;A=A+2){var z=l.parcelInfobox.LabelArray[A];var n=typeof(l.parcelInfobox.LabelArray[A+1])==undefined?"":l.parcelInfobox.LabelArray[A+1];var C=b("<tr><td>"+z+"</td><td>"+n+"</td></tr>");D.append(C);var o=typeof(l.parcelInfobox.DataArray[A])==undefined?"":l.parcelInfobox.DataArray[A];var s=typeof(l.parcelInfobox.DataArray[A+1])==undefined?"":l.parcelInfobox.DataArray[A+1];var B=b("<tr><td>"+o+"</td><td>"+s+"</td></tr>");D.append(B)}b(D).find("tr:last-child td").css({"border-bottom":"none"});l.parcelInfobox.Body.append(b('<div class="parcelInfoGrid"></div>').append(D))}if(l.parcelInfobox.HtmlContent!=null&&l.parcelInfobox.HtmlContent.length>0){l.parcelInfobox.Body.append(l.parcelInfobox.HtmlContent)}if(r.htmlContent!=null&&r.htmlContent.length>0){l.parcelInfobox.Body.append(r.htmlContent)}if(r.iconBar!=null&&r.iconBar.length>0){l.parcelInfobox.IconBar.html("");var E=b("<div></div>");if(b.isArray(r.iconBar)){b.each(r.iconBar,function(G,F){if(F=="Zoom"){E.append(b('<div class="ZoomToParcel"></div>').click(function(H){H.preventDefault();l.zoomToParcel()}))}else{if(F=="Report"){E.append(b('<div class="jqmReport"></div>').click(function(H){H.preventDefault();if(typeof(l.options.jqmLayer.parcelInfobox.reportFunction)=="function"){l.options.jqmLayer.parcelInfobox.reportFunction.call(l,l.parcelInfo)}else{b.jGrowl("Reports not set up.")}}))}else{E.append(F)}}})}else{E.append(r.iconBar)}l.parcelInfobox.Container.append(l.parcelInfobox.IconBar.append(E))}l.positionParcelInfoBox();l.parcelInfobox.Active=true;l.parcelInfobox.Container.show();function t(){var G=Bing.LocationRect.fromLocations(l.currentParcelShape.getLocations());var F=l.map.getOptions();F.bounds=G;F.padding=12;l.map.setView(F)}},positionParcelInfoBox:function(){if(!l.options.jqm.showParcelInfobox||l.currentParcelShape==null){return false}var o=Bing.PixelReference.page;var x=l.adjust;var K=b("#"+l.options.mapDiv).parents(":not(body,html)");b.each(K,function(L,M){if(b(M).css("float")==="right"){o=Bing.PixelReference.control}});var B=Bing.LocationRect.fromLocations(l.currentParcelShape.getLocations());var z=l.tryLocationToPixel(l.map.getCenter(),o);var w=b("#"+l.options.mapDiv).height();var J=b(document).height();var v=Math.abs(w-J);var p=l.tryLocationToPixel(new Bing.Location(B.getNorth(),B.getEast()),o);var u=l.tryLocationToPixel(new Bing.Location(B.getSouth(),B.getWest()),o);var r="none";var E=16;var t=l.parcelInfobox.Container.width()+l.parcelInfobox.ArrowLeft.width();var q=l.parcelInfobox.Container.height()+l.parcelInfobox.ArrowUp.height();var G=z.x-(t/2);var C=z.y-(q/2);var H=l.parcelInfobox.Title.height();var y=(l.parcelInfobox.Container.width()/2)-(l.parcelInfobox.ArrowLeft.width()/2);var F=(l.mapOffset.left+l.map.getWidth())-p.x;var D=u.x-l.mapOffset.left;var A=p.y-l.mapOffset.top;var n=(l.mapOffset.top+l.map.getHeight())-u.y;if(v>=0&&v<=10){A=p.y;n=l.map.getHeight()-u.y}if(F>t||D>t){if(F>t){r="left";G=p.x+E}else{r="right";G=u.x-t}var s=(C+l.parcelInfobox.Title.height()+(l.parcelInfobox.ArrowLeft.height()/2));var I=(C+l.parcelInfobox.Container.height()-l.parcelInfobox.IconBar.height()-(l.parcelInfobox.ArrowLeft.height()/2));if(s<p.y&&p.y<I){H=p.y-C}if(p.y>I){C+=p.y-(C+l.parcelInfobox.Container.height())+l.parcelInfobox.IconBar.height()+(l.parcelInfobox.ArrowLeft.height()/2);H=p.y-C}if(u.y<s&&u.y>(l.mapOffset.top+l.parcelInfobox.Title.height()+(l.parcelInfobox.ArrowLeft.height()/2))){C=C-s-u.y}}else{if(n>q||A>q){if(n>q){r="up";C=u.y+E}else{r="down";C=p.y-q}}}if(o==Bing.PixelReference.page){G=G-l.adjust.left;C=C-l.adjust.top}l.parcelInfobox.ArrowDown.hide();l.parcelInfobox.ArrowUp.hide();l.parcelInfobox.ArrowLeft.hide();l.parcelInfobox.ArrowRight.hide();if(l.options.jqmLayer.parcelInfobox.useArrows){switch(r){case"left":l.parcelInfobox.ArrowLeft.css({top:H});l.parcelInfobox.ArrowLeft.show();break;case"right":l.parcelInfobox.ArrowRight.css({top:H});l.parcelInfobox.ArrowRight.show();break;case"up":l.parcelInfobox.ArrowUp.css({left:y});l.parcelInfobox.ArrowUp.show();break;case"down":l.parcelInfobox.ArrowDown.css({left:y});l.parcelInfobox.ArrowDown.show();break}}l.parcelInfobox.Container.css({left:G,top:C,width:l.options.jqmLayer.parcelInfobox.width})},startInfoboxTimer:function(){if(l.pinInfobox.Timer!=null){clearTimeout(l.pinInfobox.Timer)}l.pinInfobox.Timer=setTimeout(l.timerTriggered,300)},startShapeMenuTimer:function(){if(l.shapeMenuTimer!=null){clearTimeout(l.shapeMenuTimer)}l.shapeMenuTimer=setTimeout(l.shapeMouseOut,l.options.jqm.shapeMenuDelay)},stopInfoboxTimer:function(){if(l.pinInfobox!=null&&l.pinInfobox.Timer!=null){clearTimeout(l.pinInfobox.Timer)}},stopShapeMenuTimer:function(){if(l.drawing.shapeMenu!=null&&l.shapeMenuTimer!=null){clearTimeout(l.shapeMenuTimer)}},shapeClick:function(n){if(!l.drawing.isDrawing){var o=n.target.id.split("_")[1];l.selectShape(o,b("div#shapeSummaryItem_"+o))}},shapeMouseOver:function(o){if(o.target.id==""){return}var p=o.target.id.split("_")[1];if(l.drawing.currentSelectedId!=p){if(l.drawing.mouseOverShapeId!=null&&l.drawing.mouseOverShapeId!=p){l.shapeMouseOut()}l.drawing.mouseOverShapeId=p;var q=l.drawing.shapeLayer.get(l.getShapeLayerId(p));var n=l.drawing.shapeStore[p].exclude;q.setOptions({fillColor:n?l.drawing.excludeShapeFillColor:l.drawing.shapeFillColor,strokeColor:l.drawing.shapeMouseOverLineColor,strokeThickness:l.drawing.strokeThickness+2});l.setMapPointer(l.options.jqmDrawing.shapeHoverCursor);if(l.options.jqmMenu.showShapeSummary){b("#shapeSummaryItem_"+p).removeClass("shapeSummaryItemNormal").addClass("shapeSummaryItemHover")}if(l.options.jqmDrawing.displayShapeLabel){b("#shapeLabel_"+p+" div").css("color","#00BFFF")}if(l.showEditMessage&&l.options.jqmDrawing.displayShapeEditMessage){l.showEditMessage=false;l.doAlert({text:"Click on a shape to edit."});setTimeout(function(){l.showEditMessage=true},l.editMessageInterval)}}},positionShapeMenu:function(u){if(l.options.jqmDrawing.useShapeMenu){var q=null;var s=0;if(l.options.jqmDrawing.displayShapeLabel){s=l.options.jqm.pinHeight}var t=l.drawing.shapeLayer.get(u);var o=Bing.LocationRect.fromLocations(t.getLocations());q=l.tryLocationToPixel(new Bing.Location(o.getNorth(),o.getEast()),Bing.PixelReference.page);q.x=q.x+l.options.jqm.pinWidth/2;q.y=q.y+s;var r=new Bing.Point(0,0);var n=b("#"+l.options.mapDiv).parents(":not(body,html)");b.each(n,function(w,v){var x=b(v).position();r.x+=x.left;r.y+=x.top});var p=b("#"+l.options.mapDiv).position();if(p.left==0){q.x-=l.mapOffset.left;if(r.y==0){q.y+=r.y}else{q.y-=l.mapOffset.top}}l.drawing.shapeMenu.css({top:q.y+"px",left:q.x+"px"})}},shapeMouseOut:function(){if(l.drawing.currentSelectedId!=l.drawing.mouseOverShapeId){var o=l.drawing.shapeLayer.get(l.getShapeLayerId(l.drawing.mouseOverShapeId));if(o!=undefined){var n=l.drawing.shapeStore[l.drawing.mouseOverShapeId].exclude;o.setOptions({fillColor:n?l.drawing.excludeShapeFillColor:l.drawing.shapeFillColor,strokeColor:n?l.drawing.excludeShapeLineColor:l.drawing.shapeLineColor,strokeThickness:l.drawing.strokeThickness});l.setMapPointer(l.mapGrabCur);var p=o.id.split("_")[1];if(l.options.jqmMenu.showShapeSummary){b("#shapeSummaryItem_"+p).removeClass("shapeSummaryItemHover").addClass("shapeSummaryItemNormal")}if(l.options.jqmDrawing.displayShapeLabel){b("#shapeLabel_"+p+" div").css("color","#00008B")}}}},pinInfoboxMouseLeave:function(){l.startInfoboxTimer()},pinInfoboxMouseEnter:function(){l.stopInfoboxTimer()},timerTriggered:function(){l.hideInfobox()},mapMouseWheel:function(n){if(l.options.disableMouseWheel){n.handled=true;return false}},mapViewChangeFinish:function(n){l.updatePoiPins();l.positionParcelInfoBox()},mapClick:function(q){if(l.pinInfobox.Active){l.hideInfobox();l.hideParcelInfobox()}if(l.drawing.currentSelectedId!=null){var p=l.map.tryPixelToLocation(new Bing.Point(q.getX(),q.getY()));var t=l.drawing.shapeLayer.get(l.getShapeLayerId(l.drawing.currentSelectedId));var r=l.clickInsideShape(p,t.getLocations());var o=l.drawing.shapeStore[l.drawing.currentSelectedId].shapeType;var s=false;if(l.dragHandleModule!=null){var n=l.dragHandleModule.getMaskPoints();s=l.clickInsideShape(p,n)}if(!r||!s){l.selectShape(l.drawing.currentSelectedId);l.drawing.shapeMenu.hide()}}},mapRightClick:function(q){var o=l.elements.target.offset();var u=q.pageY-o.top;var n=q.pageX-o.left;if(window.frameElement!=null){var w=b(window.frameElement).offset();u+=w.top;n+=w.left}var p=b(l.options.jqm.contextMenuContainer).height();if(u+250>p){u=Math.max(u-250,0)}l.options.jqm.contextMenuContainer.$("body").click(function(){l.options.jqm.contextMenuContainer.$("body").unbind("click");l.options.jqm.contextMenuContainer.$(".contextMenu").hide()});$contextMenu=l.options.jqm.contextMenuContainer.$(".contextMenu");$contextMenu.css("top",u+"px").css("left",n+"px").html("").show();var t=l.options.zoom;b('<div class="'+(t<19?"clsNormal":"clsDisabled")+'">Zoom In</div>').appendTo($contextMenu).click(function(){l.setZoom(l.getZoom()+1)});b('<div class="'+(t>1?"clsNormal":"clsDisabled")+'">Zoom Out</div>').appendTo($contextMenu).click(function(){l.setZoom(l.getZoom()-1)});b("<hr>").appendTo($contextMenu);var s=l.getMapType();b('<div class="'+(s==Bing.MapTypeId.auto?"clsDisabled":"clsNormal")+'">Auto</div>').appendTo($contextMenu).click(function(){l.setMapType(Bing.MapTypeId.auto,b(this))});b('<div class="'+(s==Bing.MapTypeId.road?"clsDisabled":"clsNormal")+'">Road</div>').appendTo($contextMenu).click(function(){l.setMapType(Bing.MapTypeId.road,b(this))});b('<div class="'+(s==Bing.MapTypeId.aerial?"clsDisabled":"clsNormal")+'">Aerial</div>').appendTo($contextMenu).click(function(){l.setMapType(Bing.MapTypeId.aerial,b(this))});b('<div class="'+(s==Bing.MapTypeId.birdseye?"clsDisabled":"clsNormal")+'">Birds Eye</div>').appendTo($contextMenu).click(function(){l.setMapType(Bing.MapTypeId.birdseye,b(this))});b("<hr>").appendTo($contextMenu);if(l.parcelOption==null){l.parcelOption=l.options.jqmLayer.layerValue}if(l.options.jqmMenu.showLayer){for(var r=0;r<l.options.jqmLayer.layerOptions.length;r++){var v=l.options.jqmLayer.layerOptions[r];if(!v.hide){b('<div groupId="'+v.group+'" rel="'+v.value+'" class="'+(l.parcelOption==v.value?"clsDisabled":"clsNormal")+' layerItem">'+v.text+"</div>").appendTo($contextMenu).click(function(){l.toggleLayerItem.call(l,b(this).attr("rel"))})}}}b("<hr>").appendTo($contextMenu);b('<div class="clsNormal">Print Map</div>').appendTo($contextMenu).click(function(x){l.printMap.call(l,x)});q.handled=true;return false},viewChangeEnded:function(n){l.checkIfParcelIsValid(false);l.viewChangeEnd.call(l,n);l.mapViewChangeFinish(n)},viewChange:function(n){l.updateShapeExternalObjects()},mapTypeChange:function(n){l.checkIfParcelIsValid(true);l.mapTypeChanged.call(l,n)},imageryChanged:function(n){l.checkIfParcelIsValid(true)},checkIfParcelIsValid:function(q){if(l.parcelOption!="0"&&!(l.parcelOption==null)){var o=l.map.getZoom();var r=false;var n="";var p=l.map.getImageryId();if((o>l.parcelMaxZoom||o<l.parcelMinZoom)&&!(p=="NativeBirdseye"||p=="EnhancedBirdseye")){n="Layers are not available at this zoom level.";r=true}if(!r){if(p=="NativeBirdseye"||p=="EnhancedBirdseye"){n="Layers are not available in the angled view of Bird's eye";r=true}}if(r){if(q&&n.length>0){l.doAlert({text:n})}l.changeParcelOption("0");if(l.parcelInfobox.Active){l.hideParcelInfobox()}}else{if(l.parcelOption!=l.tempParcelOption){l.changeParcelOption(l.parcelOption)}}}},showPushpin:function(o){var n=l.infoBoxes[o];if(n){Bing.Events.invoke(n.pin,"click",{target:n.pin})}},pushpinClicked:function(n){if(l.options.jqm.showPinInfobox){l.displayInfobox(n,false)}l.pushpinClick.call(l,n)},pushpinMouseovered:function(n){if(l.options.jqm.showPinInfobox){l.pushpinContinueToShow=true;l.displayInfobox(n,l.options.jqm.useMiniInfoBoxOnHover)}l.pushpinMouseover.call(l,n)},pushpinMouseouted:function(n){if(l.options.jqm.showPinInfobox){l.startInfoboxTimer();l.pushpinContinueToShow=false}l.pushpinMouseout.call(l,n)},getMapViewBoundardies:function(p){if(p==undefined||p.length<2){return}try{var o=[];for(i=0;i<p.length;i++){var q=p[i];o.push(new Bing.Location(q.latitude,q.longitude))}if(o.length>0){return Bing.LocationRect.fromLocations(o)}}catch(n){l.doAlert({text:"Error In getMapViewBoundaries: "+n})}},setMapViewBoundaries:function(n){l.map.setView({bounds:l.getMapViewBoundardies(n)})},initParcelMenu:function(){var n=l.options.jqm.menuType=="context"&&l.options.jqm.contextMenuContainer.$?l.options.jqm.contextMenuContainer.$("div[groupId=1]"):b("div.poiItem[groupId=1]","#layers");if(l.options.jqmLayer.spatialStreamKey==null||l.options.jqmLayer.spatialStreamKey==""){n.hide()}else{n.show();l.initParcelLayer(l.options.jqmLayer.layerValue)}},initParcelLayer:function(n){l.parcelLoaded=true;Dmp.HostName=window.location.protocol+"//parcelstream.com/";Dmp.Env.Connections[l.parcelConnect]=new Dmp.Conn.Connection(Dmp.HostName+"InitSession.aspx");Dmp.Env.Connections[l.parcelConnect].init(l.options.jqmLayer.spatialStreamKey,function(){l.initParcelLineLayers()},function(o){l.doAlert({text:o})});l.setupParcelColors()},initParcelLineLayers:function(){for(var p=0;p<l.options.jqmLayer.layerOptions.length;p++){var o=l.options.jqmLayer.layerOptions[p];if(o.name){var n=null;if(o.name=="ParcelLines"){n=new Dmp.Layer.TileLayer(o.name,l.parcelConnect)}else{n=new Dmp.Layer.WmsLayer(o.name,l.parcelConnect)}l.parcelLayers.push(n);l.parcelMinZoom=o.minZoom;l.parcelMaxZoom=o.maxZoom;l.parcelOption=o.id;n.addChild(o.id,o.resourceName,o.style,{zIndex:o.zIndex,zoomRange:{min:o.minZoom,max:o.maxZoom}});l.map.addEntity(n)}}l.toggleLayerItem(l.options.jqmLayer.layerValue)},setupParcelColors:function(){var n=l.options.jqmLayer.parcelSelectFillColor;l.layers.parcelSelectFillColor=new Bing.Color(n.o,n.r,n.g,n.b);var n=l.options.jqmLayer.parcelSelectLineColor;l.layers.parcelSelectLineColor=new Bing.Color(n.o,n.r,n.g,n.b);l.layers.parcelSelectLineThickness=l.options.jqmLayer.parcelSelectLineThickness},executeDriveTime:function(q,n,o){function r(y){s();if(y&&parseInt(y.Response.Results.totalRecords)==0){l.doAlert({text:"No results returns."})}var z=null;var x=null;if(y.Response.Results.RecordSet){z=y.Response.Results.RecordSet[0].Data.Row;if(y.Response.Results.RecordSet.length>1){x=y.Response.Results.RecordSet[1].Data.Row}}else{z=y.Response.Results.Data.Row}t(z.GEOMETRY);var v=Dmp.Core.WktTools.toShape(z.GEOMETRY);var w=Dmp.Core.WktTools.toShape(z.GEOMETRY);w.id="driveTimeLayer";l.layers.driveTimeLayer.push(w)}function t(w){if(l.map.getDmpLayerById("drivetime")){l.map.removeEntity("drivetime")}var v=l.driveTime;u="version.aspx?action=create&recseq=1";Dmp.Env.Connections[l.parcelConnect].getJson(u,function(y){if(y.Response.status=="success"){var x=y.Response.versionId;u="LayerCreate.aspx?includeGeometryFields=true&folder=TEMP&layer=drivetime"+x+"&definition="+encodeURI('<Layer StorageType="DB"><Description>Analysis Wizard</Description><GeometryType>POLYGON</GeometryType><Schema><ElementType name="Row"><AttributeType name="DRIVETIME" label="Drivetime" abbrname="DRIVETIME" editable="True" searchable="True" length="200"><Datatype type="string"/></AttributeType></ElementType></Schema></Layer>');Dmp.Env.Connections[l.parcelConnect].getJson(u,function(B){var A=B.Response.Success.LayerName;var z=B.Response.Success.TempId;u="http://maps.digitalmapcentral.com/production/aspx/AppUtil/GetDrivetimePolygonSS.aspx?dataSource="+A+"&versionId="+x+"&recseqs=1&host=http%3A%2F%2Fdc1.parcelstream.com%2F"+z+"%2F&SS_CANDY="+Dmp.Env.Connections[l.parcelConnect]._candy+"&driveTimes="+v+"&point="+w;Dmp.Env.Connections[l.parcelConnect].getJson(u,function(D){if(D.Response.Error){l.doAlert({text:D.Response.Error.message});return}var C=new Dmp.Layer.WmsLayer("drivetime",l.parcelConnect,{activeVersionId:x});C.addChild("drivetime",A,"PUBLIC_FOLDER/Styles/BufferedPolygon.sld.xml",{zIndex:3,zoomRange:{min:1,max:20}});l.map.addEntity(C);u=z+"/GetQuery.aspx?dataSource="+A+"&activeVersionId="+x+"&maxRecordVertices=1&returnFullWkt=true";Dmp.Env.Connections[l.parcelConnect].getJson(u,function(G){var E=G.Response.Results.Data.Row.GEOMETRY;var F=Dmp.Core.WktTools.toShape(E);var H=Microsoft.Maps.LocationRect.fromLocations(F.getLocations());viewOptions={bounds:H};l.map.setView(viewOptions);if(typeof(l.driveTimeCallBack)=="function"){l.driveTimeCallBack.call(l)}},function(E){l.doAlert({text:E})})},function(C){l.doAlert({text:C})})},function(z){l.doAlert({text:z})})}else{l.doAlert({text:"Version creation failed"})}},function(x){l.doAlert({text:x})})}function p(v){l.doAlert({text:"Dmp error "+v.Response.Error.message})}function s(){if(l.layers.driveTimeLayer==null){l.layers.driveTimeLayer=new Bing.EntityCollection();l.map.entities.push(l.layers.driveTimeLayer)}l.layers.driveTimeLayer.clear()}var u="GetGeocode.aspx?";u+="&address="+q.street;u+="&city="+q.city;u+="&state="+q.state;u+="&zip="+q.zipcode;u+="&fields=*";u+="&datasource=PARCELS,STREET_CENTERLINE";l.driveTime=n;l.driveTimeCallBack=o;Dmp.Env.Connections[l.parcelConnect].getJson(u,r,p);return false},parcelClick:function(q){function t(A){if(A.Response.Results.totalRecords<=0){l.doAlert({text:"Parcel not found."});return}var v=A.Response.Results.RecordSet;var D=null;if(v){D=v[0].Data.Row[0]}else{if(A.Response.Results.Data.Row.length){D=A.Response.Results.Data.Row[0]}else{D=A.Response.Results.Data.Row}}l.parcelInfo.LayerId=l.layers.currentLayerId;if(D.Link!=undefined){l.parcelInfo.Apn=D.Link.Row!=undefined?D.Link.Row.APN:D.APN;l.parcelInfo.Fips=D.Link.Row!=undefined?D.Link.Row.FIPS_CODE:D.FIPS;l.parcelInfo.Street=D.Link.Row!=undefined?D.Link.Row.PROP_ADDRESS:"";l.parcelInfo.City=D.Link.Row!=undefined?D.Link.Row.PROP_CITY:"";l.parcelInfo.Zip=D.Link.Row!=undefined?D.Link.Row.PROP_ZIP:"";l.parcelInfo.Zip4=D.Link.Row!=undefined?D.Link.Row.PROP_ZIP4:"";l.parcelInfo.Lat=D.Link.Row!=undefined?D.Link.Row._Y_COORD:D.CENLAT;l.parcelInfo.Lng=D.Link.Row!=undefined?D.Link.Row._X_COORD:D.CENLON;l.parcelInfo.LOCID=D.Link.Row!=undefined?D.Link.Row.LOCID:D.LOCID;l.parcelInfo.State=D.Link.Row!=undefined?D.Link.Row.PROP_STATE:D.STATE}var u="";u+=l.parcelInfo.City!=undefined?l.parcelInfo.City:"";if(u.length>0){u+=", "}u+=l.parcelInfo.State!=undefined?l.parcelInfo.State+" ":"";u+=l.parcelInfo.Zip!=undefined?l.parcelInfo.Zip:"";if(u.length>0&&l.parcelInfo.Zip!=undefined){u+=l.parcelInfo.Zip!=undefined?"+"+l.parcelInfo.Zip4:""}l.parcelInfo.FormatedRegion=u;l.parcelInfo.FormatedAddress=l.parcelInfo.Street!=undefined?l.parcelInfo.Street+" "+u:u;l.parcelInfo.RecorHandle=D.RECORD_HANDLE;l.parcelInfo.Metro=D.METRO;l.parcelInfo.NeighborhoodName=D.NEIGHBORHD;l.parcelInfo.NeighborhoodId=D.NID;l.parcelInfo.County=D.COUNTY;l.parcelInfo.CBSA=D.CBSA;l.parcelInfo.CBSACode=D.CBSACODE;l.parcelInfo.CBSAType=D.CBSATYPE;r();var z=D.GEOMETRY;z=z.replace("POLYGON","").replace("((","").replace("))","").trim();z=z.split(",");var x=[];b.each(z,function(F,G){var E=G.trim().split(" ");x.push(new Bing.Location(E[1],E[0]))});var C={fillColor:l.layers.parcelSelectFillColor,strokeColor:l.layers.parcelSelectLineColor,strokeThickness:l.layers.parcelSelectLineThickness};if(l.parcelInfo.Lat==undefined||l.parcelInfo.Lng==undefined){var w=Microsoft.Maps.LocationRect.fromLocations(x);l.parcelInfo.Lat=w.center.latitude;l.parcelInfo.Lng=w.center.longitude}l.currentParcelShape=new Bing.Polygon(x,C);l.currentParcelShape.Id="selectedLayerShape";l.layers.parcelInteractionLayer.push(l.currentParcelShape);if(l.options.jqm.showParcelInfobox){if(typeof(l.beforeParcelInfobox)=="function"){l.beforeParcelInfobox.call(l,l.parcelInfo)}else{l.showParcelInfobox()}}if(l.layers.currentLayerId=="ParcelLines"){if(D.APN!=undefined&&D.APN.length>0&&l.options.jqmLayer.parcelDimensionOption!="None"){var B=D.LOCID;var y=l.options.jqmLayer.parcelDimensionOptions[l.options.jqmLayer.parcelDimensionOption];if(l.layers.parcelDimensionLayer!=null){l.map.removeEntity("dimensionLayer");l.layers.parcelDimensionLayer=null}l.layers.parcelDimensionLayer=new Dmp.Layer.WMSLayer("dimensionLayer",l.parcelConnect,{showField:"LOCID",showValues:B});l.layers.parcelDimensionLayer.addChild("dimensionLayer",A.Response.Results.datasource,y,{zoomRange:{min:l.parcelMinZoom,max:l.parcelMaxZoom}});l.map.addEntity(l.layers.parcelDimensionLayer)}else{l.doAlert({text:"This property does not have an assigned APN and we are unable to generate dimensions. Please select another property."})}}}function o(u){}function n(u){l.doAlert({text:"Dmp error "+u.Response.Error.message})}function r(){if(l.layers.parcelInteractionLayer==null){l.layers.parcelInteractionLayer=new Bing.EntityCollection();l.map.entities.push(l.layers.parcelInteractionLayer)}l.layers.parcelInteractionLayer.clear()}if(!l.drawing.isDrawing){l.parcelInfo={};if(Math.abs(l.layers.parcelClickLocation.x-q.getX())+Math.abs(l.layers.parcelClickLocation.y-q.getY())>10){return false}var p=l.tryPixelToLocation(new Bing.Point(q.getX(),q.getY()));var s="getByGeometry.aspx?returnGeoType=1&dataSource="+l.layers.currentLayerResourceName+"&Geo=POINT("+p.longitude+" "+p.latitude+")"+l.layers.currentLayerQuery;Dmp.Env.Connections[l.parcelConnect].getJson(s,t,n);q.handled=true;return false}},toggleLegend:function(n){if(!l.elements.legend.is(":visible")){if(l.drawing.currentSelectedId!=null){l.selectShape(l.drawing.currentSelectedId)}l.elements.legend.css({left:n.pageX-l.adjust.left,top:n.pageY-l.adjust.top+15})}l.elements.legend.toggle(500)},togglePoi:function(n){var o=b("#poi");if(!o.is(":visible")&&n){if(l.drawing.currentSelectedId!=null){l.selectShape(l.drawing.currentSelectedId)}o.css({left:n.pageX-l.adjust.left-15,top:n.pageY-l.adjust.top+15})}o.toggle(500)},togglePoiItem:function(n){l.addPoiPins(n,true);if(b("div.poiItemSelected").length==0){b("#btnClearPOI").attr("disabled","disabled")}},updatePoiPins:function(){if(l.options.jqm.autoUpdatePOIpins&&l.options.jqmMenu.showPoi&&Bing.Search!=undefined){var n=b("div.poiItemSelected");if(n!=null&&n.length>0){b.each(n,function(p,r){var q=b(r).attr("index");var o=l.poiLayers[q];if(o){l.removePoiPins(q)}l.addPoiPins(b(r),false)})}}},addPoiPins:function(n,p){if(!l.searchManager){l.searchManager=true;Bing.loadModule("Microsoft.Maps.Search",{callback:function(){l.addPoiPins(n)}});return}else{if(l.searchManager===true){l.searchManager=new Bing.Search.SearchManager(l.map)}}var o=n.attr("index");var r=l.getCenter();var q=b("div.poiToolbar input").val();if(!b.isNumeric(q)){l.doAlert({text:"Please enter a valid number for the radius."});return}if(!l.poiLayers){l.poiLayers=[]}if(!l.poiLayers[o]){l.poiLayers[o]=new Bing.EntityCollection();l.map.entities.push(l.poiLayers[o]);n.addClass("poiItemSelected");if(!l.poiInfoBoxes[o]){l.poiInfoBoxes[o]=[]}var t=n.attr("mapIcon");var s={query:n.attr("rel"),count:l.options.jqm.maxPOIs,callback:function(z,x){var G=0;if(z.searchResults){G=z.searchResults.length}l.doAlert({text:"Found "+G+" locations."});if(G>0){var D=z.searchResults;for(var E=0;E<D.length;E++){var y=D[E];var B=new Bing.Location(y.location.latitude,y.location.longitude);var C=new Bing.Pushpin(B,{text:"",icon:"",width:23,height:30,typeName:t+" pintip",textOffset:new Bing.Point(0,0)});C._id="poi_"+o+"_"+E;var F=Bing.Events.addHandler(C,"click",l.pushpinClicked);var w=Bing.Events.addHandler(C,"mouseover",l.pushpinMouseovered);var u=Bing.Events.addHandler(C,"mouseout",l.pushpinMouseouted);l.poiLayers[o].push(C);if(y.name){var A=["Address"," "];var v=[y.address,y.city+", "+y.state+" "+y.postalCode];if(y.website){A.push("URL");v.push('<a href="'+y.website+'" target="_new">Website</a>')}if(y.phone){A.push("Phone");v.push(y.phone)}if(l.options.jqmMenu.poiShowUserRating&&y.userRating){A.push("Bing User Rating");v.push(y.userRating)}infoBoxData={InfoBoxTitle:y.name,InfoBoxTitleClass:"pushpinPopupTitle9",InfoBoxLabels:A,InfoBoxData:v};l.poiInfoBoxes[o][E]=infoBoxData}}}},errorCallback:function(){l.doAlert({text:"Error finding Point of Interest"})}};l.searchManager.search(s)}else{if(p){l.removePoiPins(o)}}},removePoiPins:function(n){l.map.entities.remove(l.poiLayers[n]);l.poiLayers[n]=null;b("div.poiItem[index="+n+"]").removeClass("poiItemSelected")},toggleResizeMap:function(n){var o=b("#resizeMap");if(!o.is(":visible")&&n){if(l.drawing.currentSelectedId!=null){l.selectShape(l.drawing.currentSelectedId)}o.css({left:n.pageX-l.adjust.left-15,top:n.pageY-l.adjust.top+15})}o.toggle(500)},doResizeMapItem:function(n){b("#resizeMap div.poiItemSelected").removeClass("poiItemSelected");var o=JSON.parse(n.attr("rel"));l.resizeMap(o);n.addClass("poiItemSelected");l.resizeMapItem.call(l,o);if(b("#resizeMap").is(":visible")){l.toggleResizeMap()}},toggleShapes:function(){if(l.options.jqmDrawing.shapeInfo){if(l.drawing.shapeLayer.getLength()>0){l.drawing.shapeLayer.clear()}else{l.drawShapes(l.options.jqmDrawing.shapeInfo)}}},toggleLayers:function(n){var o=b("#layers");if(!o.is(":visible")&&n){if(l.drawing.currentSelectedId!=null){l.selectShape(l.drawing.currentSelectedId)}o.css({left:n.pageX-l.adjust.left-15,top:n.pageY-l.adjust.top+15})}o.toggle(500)},getLayer:function(o){for(var n=0;n<=l.parcelLayers.length;n++){if(l.parcelLayers[n].id==o){return l.parcelLayers[n]}}},getLayerOption:function(o){for(var n=0;n<l.options.jqmLayer.layerOptions.length;n++){if(l.options.jqmLayer.layerOptions[n].value==o){return l.options.jqmLayer.layerOptions[n]}}},toggleLayerItem:function(t){var r;var q="poiItemSelected";var p;var s="";if(l.options.jqm.menuType=="context"){r=l.options.jqm.contextMenuContainer.$("div.layerItem[rel="+t+"]");q="clsDisabled";s="clsNormal";var o=r.attr("groupId");p=l.options.jqm.contextMenuContainer.$("div."+q+"[groupId="+o+"]")}else{r=b("div.poiItem[rel="+t+"]","#layers");var o=r.attr("groupId");p=b("div."+q+"[groupId="+o+"]")}p.removeClass(q).addClass(s);var n=l.getLayerOption(t);if(n!=null&&n.type=="BingTraffic"){if(l.trafficLayer){if(l.trafficLayerShown){l.trafficLayer.hide()}else{r.addClass(q);l.trafficLayer.show()}l.trafficLayerShown=!l.trafficLayerShown}else{r.addClass(q);Bing.loadModule("Microsoft.Maps.Traffic",{callback:l.trafficModuleLoaded})}}else{r.addClass(q);l.parcelOption=t;if(l.parcelOption=="0"){l.changeParcelOption("0")}else{l.parcelMinZoom=n.minZoom;l.parcelMaxZoom=n.maxZoom;l.checkIfParcelIsValid(true)}}if(b("#layers").is(":visible")){l.toggleLayers()}},togglePinLayerItem:function(t){var q;var p="pinItemSelected";var o;var s="";if(l.options.jqm.menuType=="context"){q=l.options.jqm.contextMenuContainer.$("div.pinlayerItem[rel="+t+"]");p="clsDisabled";s="clsNormal";var n=q.attr("groupId");o=l.options.jqm.contextMenuContainer.$("div."+p+"[groupId="+n+"]")}else{q=b("div.pinItem[rel="+t+"]","#pinLayers")}q.removeClass(p).addClass(s);var r=l.isPinLayerVisible(t);l.setPinLayerVisible(!r,t);if(!r){q.addClass(p)}if(b("#pinLayers").is(":visible")){l.togglePinLayers()}},togglePinLayers:function(n){var o=b("#pinLayers");if(!o.is(":visible")&&n){if(l.drawing.currentSelectedId!=null){l.selectShape(l.drawing.currentSelectedId)}o.css({left:n.pageX-l.adjust.left-15,top:n.pageY-l.adjust.top+15})}o.toggle(500)},changeParcelOption:function(n){if(l.layers.onMouseClickEventObj!=null){Bing.Events.removeHandler(l.layers.onMouseClickEventObj);l.layers.onMouseClickEventObj=null}if(l.layers.onMouseDownEventObj!=null){Bing.Events.removeHandler(l.layers.onMouseDownEventObj);l.layers.onMouseDownEventObj=null}if(l.layers.onMouseUpEventObj!=null){Bing.Events.removeHandler(l.layers.onMouseUpEventObj);l.layers.onMouseUpEventObj=null}if(l.layers.parcelInteractionLayer!=null){l.map.removeEntity(l.layers.parcelInteractionLayer);l.layers.parcelInteractionLayer.clear();l.parcelInfobox.Container.hide()}if(l.layers.parcelDimensionLayer!=null){l.map.removeEntity("dimensionLayer");l.layers.parcelDimensionLayer=null}if(!l.parcelLoaded){l.initParcelLayer(n)}else{for(var p=l.map.dmpLayers.length;p>=0;p--){l.map.removeEntity(l.map.dmpLayers[p])}var o=l.getLayerOption(n);if(o!=null&&o.type=="DMP"){l.map.addEntity(l.getLayer(o.id));if(b.isArray(o.addIds)){b.each(o.addIds,function(r,q){l.map.addEntity(l.getLayer(q))})}if(l.options.jqmLayer.clickableLayers.indexOf(o.name)>-1&&l.options.jqmLayer.parcelLayerInteractive){l.layers.onMouseDownEventObj=Bing.Events.addHandler(l.map,"mousedown",function(q){l.layers.parcelClickLocation={x:q.getX(),y:q.getY()}});l.layers.onMouseUpEventObj=Bing.Events.addHandler(l.map,"mouseup",function(q){l.parcelClick.call(l,q)})}}l.layers.currentLayerId=o.id;l.layers.currentLayerResourceName=o.resourceName;if(typeof(o.altResource)!="undefined"){l.layers.currentLayerResourceName=o.altResource}l.layers.currentLayerQuery=o.dataQuery;l.tempParcelOption=n}},trafficModuleLoaded:function(){l.trafficLayer=new Bing.Traffic.TrafficLayer(l.map);l.trafficLayer.show();l.trafficLayerShown=true},toggleAddress:function(o){var n=b(".addressContainer");var p=n.is(":visible");if(!p&&o){if(l.drawing.currentSelectedId!=null){l.selectShape(l.drawing.currentSelectedId)}n.css({left:o.pageX-l.adjust.left,top:o.pageY-l.adjust.top+15})}n.toggle(500);if(!p){b("#txtAddress").focus()}},loadAddress:function(n){var n={address:b("#txtAddress").val(),city:b("#txtCity").val(),state:b("#txtState").val(),zip:b("#txtZip").val()};l.getAddress(n);l.toggleAddress()},getAddress:function(p,n,o){var q=l.options.jqm.restUrl+"/"+l.options.jqm.restVersion+"/Locations?CountryRegion="+l.options.jqm.countryRegion;b.ajax({url:q,data:{adminDistrict:p.state,locality:p.city,postalCode:p.zip,addressLine:p.address,key:l.options.credentials},dataType:"jsonp",jsonp:"jsonp",success:function(t){var r=t.resourceSets[0];if(r){if(r.estimatedTotal>0){var s=r.resources[0].point.coordinates;if(n){l.options.jqm.centerLatitude=s[0];l.options.jqm.centerLongitude=s[1];g.call(l)}else{if(o||o===undefined){l.setCenter(new Bing.Location(s[0],s[1]))}}}}}})},printMap:function(){if(b.browser.msie){document.execCommand("print",false,null)}else{window.focus();window.print()}},updateCount:function(n){l.drawing.countElement.text(b.formatNumber(n,{locale:"us"})).format({format:"#,##0"}).html();l.drawing.countContainerElement.show()},redrawPins:function(o,n){l.clearPins(n);l.addPins(o,n)},clearPins:function(n){var o=l.getPinLayerByName(n);o.clear()},initDirectionsModule:function(){Bing.loadModule("Microsoft.Maps.Directions",{callback:l.registerDrivingDirectionsEvents})},drivingDirectionsReady:function(){return l.directionsManager!=null},showDrivingDirectionsDiv:function(){if(!l.directionsManager){l.initDirectionsModule()}else{if(l.displayingDirections){l.hideDrivingDirections()}else{if(l.drawing.currentSelectedId!=null){l.selectShape(l.drawing.currentSelectedId)}l.displayDrivingDirections()}}},registerDrivingDirectionsEvents:function(){l.directionsManager=new Bing.Directions.DirectionsManager(l.map);Bing.Events.addHandler(l.directionsManager,"directionsError",o);Bing.Events.addHandler(l.directionsManager,"beforeDisambiguationRender",p);Bing.Events.addHandler(l.directionsManager,"directionsUpdated ",q);l.directionsManager.resetDirections();l.directionsManager.setRequestOptions({routeMode:Bing.Directions.RouteMode.driving,autoDisplayDisambiguation:l.options.jqm.autoHandleAmbiguousAddresses});if(document.getElementById("directionsContainer")){l.directionsManager.setRenderOptions({itineraryContainer:document.getElementById("directionsContainer")});b("#directionsContainer").append('<span class="jqBingMap_summaryLoading"></span>')}if(l.options.jqmMenu.showDrivingDirections){l.displayDrivingDirections()}function o(r){if(r.message){b.jGrowl(r.message)}}function q(r){l.directionsReady=true}function p(r){var s='<div class="directionsError" style="color: red; font-weight:bold; font-size: 18px;">Ambiguous Address found</div>';b(r.containerElement).html(s)}function n(){b("#directionsContainer").remove("div.directionsError")}},displayDrivingDirections:function(){var o=null;if(b.isFunction(l.getCheckedIds)){o=[];var q=l.getCheckedIds.call(l);for(var t=0;t<q.length;t++){for(var s=0;s<l.options.jqm.locations.length;s++){if(l.options.jqm.locations[s].ID==q[t]){o.push(l.options.jqm.locations[s])}}}}else{o=l.options.jqm.locations}if(o==null||o.length==0){l.doAlert({text:"Please select some Listings"});return}if(o.length>25){l.doAlert({text:"The maximum number of listings for driving directions is 25."});return}l.options.jqm.leftOffset=300;l.resizeMap({height:500,width:700});l.displayingDirections=true;l.onShowDirections.call(l);var r=l.elements.target.offset();var n=l.elements.target.height();l.elements.directionsContainer.css({top:n.top+n,left:r.top,height:l.docHeight}).show();l.elements.directionsPicker.css({top:r.top,left:710,height:n}).show();l.elements.directionsPicker.html("");l.hideAllPinLayers();b('<a href="javascript: ;">Add Destination</a>').appendTo(l.elements.directionsPicker).click(function(){l.addDrivingDestination()});var p=b('<ul id="directionsSort"/>').appendTo(l.elements.directionsPicker);for(t=0;t<o.length;t++){var v=o[t];l.directionsManager.addWaypoint(new Bing.Directions.Waypoint({location:new Bing.Location(v.latitude,v.longitude)}));var u=b('<li class="ui-corner-all" rel="'+v.ID+'"></li>').appendTo(p);b('<div class="ui-icon ui-icon-arrowthick-2-n-s"></div>').appendTo(u);b('<div class="removedd"></div>').appendTo(u).click(function(){b(this).parent().remove()});b('<div class="mapLabeldd">'+String.fromCharCode(t+65)+"</div>").appendTo(u);b('<div class="descLabeldd">'+v.InfoBoxTitle+"</div>").appendTo(u)}p.sortable();var p=b('<button id="recalculate">GO</button>').appendTo(l.elements.directionsPicker).click(function(){l.recalculateDirections()});l.directionsManager.calculateDirections()},clearDrivingDirectionsWaypoints:function(){if(l.directionsManager!=null){l.directionsManager.resetDirections({removeAllWaypoints:true})}},hideDrivingDirections:function(){l.displayingDirections=false;l.onHideDirections.call(l);if(l.elements.directionsContainer!=null){l.elements.directionsContainer.hide()}if(l.elements.directionsPicker!=null){l.elements.directionsPicker.hide()}l.directionsManager.resetDirections({removeAllWaypoints:true});l.showPreviousPinLayer()},addDrivingDestination:function(){var n=b("<li></li>").prependTo(b("#directionsSort"));b('<div class="ui-icon ui-icon-arrowthick-2-n-s"></div>').appendTo(n);b('<div class="removedd"></div>').appendTo(n).click(function(){b(this).parent().remove();b("#recalculate").click()});b('<div class="mapLabeldd">&nbsp;</div>').appendTo(n);b('<input type="text"/>').appendTo(n)},setAddressArray:function(n){l.addresses=n},drivingDirectionsReadyforPrint:function(){return l.directionsReady},recalculateDirections:function(){if(l.directionsManager==null){l.doAlert({text:"Driving Directions not initialized, use initDirectionsModule prior to using recalculateDirections."});return}l.directionsReady=false;l.directionsManager.resetDirections({removeAllWaypoints:true});if(l.addresses!=null&&l.addresses.length>0){for(i=0;i<l.addresses.length;i++){var n=l.addresses[i];if(n.length>0){l.directionsManager.addWaypoint(new Bing.Directions.Waypoint({address:n}))}}}else{b("#directionsSort li").each(function(s){var o=b(this).attr("rel");var t=true;if(o){var p=null;for(var q=0;q<l.options.jqm.locations.length;q++){if(l.options.jqm.locations[q].ID==o){p=l.options.jqm.locations[q]}}if(p){l.directionsManager.addWaypoint(new Bing.Directions.Waypoint({location:new Bing.Location(p.latitude,p.longitude)}))}}else{var r=b("input",this).val();if(r.length>0){l.directionsManager.addWaypoint(new Bing.Directions.Waypoint({address:r}))}else{t=false}}if(t){b(".mapLabeldd",this).html(String.fromCharCode(s+65))}})}l.directionsManager.calculateDirections();if(document.getElementById("directionsContainer")){if(!l.options.jqmMenu.showDrivingDirections){b("#directionsContainer").show("100")}}},MapTypes:function(){return Bing.MapTypeId},setMapType:function(o,n){l.map.setMapType(o);if(n){n.parent().find("div.clsDisabled").removeClass("clsDisabled").addClass("clsNormal");n.removeClass("clsNormal").addClass("clsDisabled")}},getMapType:function(){return l.map.getMapTypeId()},getZoom:function(){return parseInt(l.map.getZoom(),10)},setZoom:function(n){l.map.setView({zoom:n})},getCenter:function(){return l.map.getCenter()},getParcelCenter:function(){var n=Bing.LocationRect.fromLocations(l.currentParcelShape.getLocations());return n.center},getParcelInfo:function(){return l.parcelInfo},getParcelAPN:function(){return typeof(l.parcelInfo.Apn)!="undefined"?l.parcelInfo.Apn:"unavailable"},getParcelFips:function(){return typeof(l.parcelInfo.Fips)!="undefined"?l.parcelInfo.Fips:"unavailable"},getParcelAddress:function(){return parcelInfo.FormatedAddress},getParcelLatLng:function(){return typeof(l.parcelInfo.Lat)!="undefined"?new Bing.Location(l.parcelInfo.Lat,l.parcelInfo.Lng):null},positionDockMenu:function(){b(".dockMenu").css({left:(l.mapOffset.left-l.adjust.left+123)+"px",top:l.mapOffset.top-l.adjust.top+"px"})},destroy:function(){var o,p,n;p=l.beforeDestroy.call(l);if(p===false){return l}if(l.status.rendered){}else{l.options.show.when.target.unbind(l.options.show.when.event+".jqBingMap-create")}if(typeof l.elements.target.data("jqBingMap")=="object"){n=l.elements.target.data("jqBingMap").interfaces;if(typeof n=="object"&&n.length>0){for(o=0;o<n.length-1;o++){if(n[o].id==l.id){n.splice(o,1)}}}}delete b.fn.jqBingMap.interfaces[l.id];if(typeof n=="object"&&n.length>0){l.elements.target.data("jqBingMap").current=n.length-1}else{l.elements.target.removeData("jqBingMap")}return l.elements.target}})}function a(){var j=this;if((j.options.jqm.centerLatitude==null||j.options.jqm.centerLatitude==""||j.options.jqm.centerLatitude==0)&&j.options.jqm.locations==null){j.getAddress(j.options.jqmMenu.addressInfo,true)}else{g.call(j)}}function g(){var H=this;H.options.mapDiv=H.elements.target.attr("id");H.beforeRender.call(H);H.status.rendered=true;H.status.isIE9=b.browser.msie&&b.support.opacity;try{H.docHeight=b("#"+H.options.mapDiv).parent().height();H.docWidth=b("#"+H.options.mapDiv).parent().width()}catch(C){H.docHeight=b(window).height();H.docWidth=b(window).width()}H.mapOffset=H.elements.target.offset();H.adjust={left:0,top:0};try{if(b("#"+H.options.mapDiv).css("position")!="relative"){H.adjust=b("#"+H.options.mapDiv).parent().offset()}else{if(b("#"+H.options.mapDiv).css("position")=="relative"&&b("#"+H.options.mapDiv).parent().css("position")!="relative"){H.adjust={left:0,top:0}}else{if(b("#"+H.options.mapDiv).css("position")=="relative"&&b("#"+H.options.mapDiv).parent().css("position")=="relative"){H.adjust=H.elements.target.offset()}}}}catch(C){}if(H.options.jqm.isTouchDevice==null){H.options.jqm.isTouchDevice=!!("ontouchstart" in window)}Bing=Microsoft.Maps;if(H.options.jqm.menuType=="dock"&&H.options.jqm.isTouchDevice){H.options.jqm.menuType="normal"}for(var u=0;u<H.options.jqmLayer.excludeLayers.length;u++){for(var t=0;t<H.options.jqmLayer.layerOptions.length;t++){if(H.options.jqmLayer.excludeLayers[u]==H.options.jqmLayer.layerOptions[t].value){H.options.jqmLayer.layerOptions[t].hide=true}}}if(H.options.jqm.menuType=="context"){if(H.options.jqm.contextMenuContainer.$){var q=H.options.jqm.contextMenuContainer.$(".contextMenu");if(q.length==0){var B='<style type="text/css"> ';B+=" .contextMenu {display: none; position: absolute; width: 150px; z-index: 10; background-color: lightgrey; margin : 2px; border : 2px outset font-size : 8pt; padding: 5px;} ";B+=".contextMenu DIV {padding:2px 10px; color: black;}";B+=".contextMenu DIV.clsDisabled {color:gray;}";B+=".contextMenu DIV.clsNormal:hover {background: blue; color: White; cursor: pointer}";B+=" </style>";H.options.jqm.contextMenuContainer.$("body").append(B);q=b('<div class="contextMenu hideWhenPrinted"></div>').appendTo(H.options.jqm.contextMenuContainer.$("body"))}}}else{var s=H.options.jqmMenu.showDrawingTools?3:0;s+=H.options.jqmMenu.showLayer?1:0;s+=H.options.jqmMenu.showAddress?1:0;s+=H.options.jqmMenu.showLocator?1:0;s+=H.options.jqmMenu.showShapeIcon?1:0;s+=H.options.jqmMenu.showDrivingDirections?1:0;s+=H.options.jqmMenu.showPoi?1:0;s+=H.options.jqmMenu.showResize?1:0;s+=H.options.jqmMenu.showLegend?1:0;s+=H.options.jqmMenu.showPrint?1:0;s+=H.options.jqmMenu.showPinLayerPicker?1:0;if(s>0){var y=H.elements.target.parent();var p=H.options.jqm.menuType=="normal"?46:36;var K=H.elements.target.offset();var x=b('<div class="dockMenu"/>').css({left:(H.mapOffset.left-H.adjust.left+123)+"px",top:H.mapOffset.top-H.adjust.top+"px",width:(10+(s*p))+"px",height:H.options.jqm.menuType=="normal"?"40px":"30px"});if(H.options.jqmMenu.showDrivingDirections){b('<img src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/drivingdirections.png?"+H.options.jqm.scriptVersion+'" title="Directions" />').appendTo(x).click(function(){H.showDrivingDirectionsDiv(H,-1)});H.elements.directionsContainer=b('<div id="directionsContainer"/>').appendTo(y);H.elements.directionsPicker=b('<div id="directionsPicker"/>').appendTo(y)}if(H.options.jqmMenu.showShapeIcon){b('<img src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/shapes.png?"+H.options.jqm.scriptVersion+'" title="Shapes" />').appendTo(x).click(function(){H.toggleShapes()})}if(H.options.jqmMenu.showDrawingTools){b('<img class="ui-corner-all" src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/polygon.png?"+H.options.jqm.scriptVersion+'" title="Polygon" />').appendTo(x).click(function(){H.drawingImageClick.call(H,{shapeGeomType:"Polygon",imageElement:this})});b('<img class="ui-corner-all" src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/rubberband.png?"+H.options.jqm.scriptVersion+'" title="'+H.options.jqmMenu.rubberbandName+'" />').appendTo(x).click(function(){H.drawingImageClick.call(H,{shapeGeomType:"Rubberband",imageElement:this})});b('<img class="ui-corner-all" src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/radius.png?"+H.options.jqm.scriptVersion+'" title="Radius" />').appendTo(x).click(function(){H.drawingImageClick.call(H,{shapeGeomType:"Radius",imageElement:this})});H.drawing.distanceElement=b('<div id="divDistance"></div>').appendTo(y);H.drawing.radiusElement=b('<div class="ui-corner-all" id="divRadius"></div>').appendTo(y);b("<span>Radius from center of map in miles: </span>").appendTo(H.drawing.radiusElement);b('<input name="txtRadius" type="text" id="txtRadius" />').appendTo(H.drawing.radiusElement);b('<input name="btnRadius" type="button" id="btnRadius" value="Go" title="This center of the map will be used for the starting point." />').appendTo(H.drawing.radiusElement).click(function(){H.drawRadius.call(H,b("#txtRadius").val())})}if(H.options.jqmMenu.showLocator){b('<img class="ui-corner-all" src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/locator.png?"+H.options.jqm.scriptVersion+'" title="Locator" />').appendTo(x).click(function(){H.drawingImageClick.call(H,{shapeGeomType:"Locator",imageElement:this})})}if(H.options.jqmMenu.showLayer){b('<img src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/layers.png?"+H.options.jqm.scriptVersion+'" title="Layers" />').appendTo(x).click(function(j){H.toggleLayers.call(H,j)});var I=b('<div id="layers" class="ui-corner-all"></div>');var E=b('<div class="legendTitle">Layers</div>').appendTo(I);b('<div class="legendClose"/>').appendTo(E).click(function(j){H.toggleLayers.call(H,j)});for(var u=0;u<H.options.jqmLayer.layerOptions.length;u++){var A=H.options.jqmLayer.layerOptions[u];if(!A.hide){var l=b('<div groupId="'+A.group+'" rel="'+A.value+'" class="ui-corner-all poiItem"/>').appendTo(I).click(function(){H.toggleLayerItem.call(H,b(this).attr("rel"))});b('<div class="poiItemDesc">'+A.text+"</div>").appendTo(l);if(u<H.options.jqmLayer.layerOptions.length-1&&H.options.jqmLayer.layerOptions[u+1].group!=A.group){b('<div class="separator"></div>').appendTo(I)}}else{b.jGrowl(A.text)}}I.appendTo(y)}if(H.options.jqmMenu.showAddress){b('<img src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/address.png?"+H.options.jqm.scriptVersion+'" title="Address" />').appendTo(x).click(function(j){H.toggleAddress.call(H,j)});var z=b('<div class="addressContainer ui-corner-all"></div>');var J=b('<div class="legendTitle">Address</div>').appendTo(z);b('<div class="legendClose"/>').appendTo(J).click(function(j){H.toggleAddress.call(H,j)});b('<input id="txtAddress" name="txtAddress" type="text" maxlength="100" tabindex="1">').appendTo(z).val(H.options.jqmMenu.addressInfo.address);b('<input id="txtCity" name="txtCity" type="text" maxlength="50" tabindex="2">').appendTo(z).val(H.options.jqmMenu.addressInfo.city);b('<input id="txtState" name="txtState" type="text" maxlength="2" tabindex="3">').appendTo(z).val(H.options.jqmMenu.addressInfo.state);b('<input id="txtZip" name="txtZip" type="text" maxlength="10" tabindex="4">').appendTo(z).val(H.options.jqmMenu.addressInfo.zip);b('<input type="button" id="findAddress" value="Get Address" tabindex="5">').appendTo(z).click(function(j){H.loadAddress.call(H,j)});z.appendTo(y)}if(H.options.jqmMenu.showPoi){b('<img src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/poi.png?"+H.options.jqm.scriptVersion+'" title="Points of Interest" />').appendTo(x).click(function(j){H.togglePoi.call(H,j)});var F=b('<div id="poi" class="ui-corner-all"></div>');var E=b('<div class="legendTitle">Points of Interest</div>').appendTo(F);$divpoiLeft=b('<div class="poiLeft"></div>').appendTo(F);$divpoiRight=b('<div class="poiRight"></div>').appendTo(F);b('<input name="btnClearPOI" type="button" id="btnClearPOI" value="Clear selected" title="Clear all Selected Points of Interet from map." disabled="disabled" />').appendTo(F).click(function(j){b.each(b("div.poiItemSelected"),function(M,L){b(L).click()})});var w=b('<div class="poiToolbar"></div>').appendTo(F);b("<div>Search Radius:</div>").appendTo(w);b('<input type="text" maxlength="4" value="20"/>').appendTo(w);b("<div>By default the Points of Interest will only display within 20 miles of your center location on the map.  If you move the map in any direction you will need to apply the POI again to adjust to the new location.  You can increase the miles from your center location below.</div>").appendTo(w);b('<div class="legendClose"/>').appendTo(E).click(function(j){H.togglePoi.call(H,j)});for(var u=0;u<H.options.jqmMenu.poiItems.length;u++){var G=H.options.jqmMenu.poiItems[u];var v=b('<div index="'+u+'" rel="'+G.searchItem+'" mapIcon="'+G.mapIcon+'" class="ui-corner-all poiItem"/>').appendTo(u%2==0?$divpoiLeft:$divpoiRight).click(function(){b("#btnClearPOI").removeAttr("disabled");H.togglePoiItem.call(H,b(this))});if(G.className){b('<div class="poiItemImg '+G.className+'"/>').appendTo(v)}b('<div class="poiItemDesc">'+G.description+"</div>").appendTo(v)}F.appendTo(y)}if(H.options.jqmMenu.showResize){b('<img src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/resizemap.png?"+H.options.jqm.scriptVersion+'" title="Resize" />').appendTo(x).click(function(j){H.toggleResizeMap.call(H,j)});var k=H.elements.target.width();var I=b('<div id="resizeMap" class="ui-corner-all"></div>');var E=b('<div class="legendTitle">Map Resize</div>').appendTo(I);b('<div class="legendClose"/>').appendTo(E).click(function(j){H.toggleResizeMap.call(H,j)});for(var u=0;u<H.options.jqmMenu.resizeItems.length;u++){var D=H.options.jqmMenu.resizeItems[u];var l=b('<div class="ui-corner-all poiItem'+(k==D.width?" poiItemSelected":"")+'"/>').appendTo(I).click(function(){H.doResizeMapItem.call(H,b(this))}).attr("rel",'{"width":'+D.width+', "height": '+D.height+"}");b('<div class="poiItemDesc">'+D.description+"</div>").appendTo(l)}I.appendTo(y)}if(H.options.jqmMenu.showLegend){b('<img src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/legend.png?"+H.options.jqm.scriptVersion+'" title="Legend" />').appendTo(x).click(function(j){H.toggleLegend.call(H,j)});H.elements.legend=b('<div id="legend" class="ui-corner-all"></div>');var E=b('<div class="legendTitle">Legend</div>').appendTo(H.elements.legend);b('<div class="legendClose"/>').appendTo(E).click(function(j){H.toggleLegend.call(H,j)});for(var u=0;u<H.options.jqmMenu.legendItems.length;u++){var n=H.options.jqmMenu.legendItems[u];var o=b('<div class="LegendItemCon"/>').appendTo(H.elements.legend);if(n.className){b('<div class="LegendItemImg '+n.className+'"></div>').appendTo(o)}b('<div class="LegendItem">'+n.description+"</div>").appendTo(o)}H.elements.legend.appendTo(y)}if(H.options.jqmMenu.showPinLayerPicker){b('<img src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/Pinlayers.png?"+H.options.jqm.scriptVersion+'" title="Pins" />').appendTo(x).click(function(j){H.togglePinLayers.call(H,j)});var I=b('<div id="pinLayers" class="ui-corner-all"></div>');var E=b('<div class="legendTitle">Display on map</div>').appendTo(I);b('<div class="legendClose"/>').appendTo(E).click(function(j){H.togglePinLayers.call(H,j)});I.appendTo(y)}if(H.options.jqmMenu.showPrint){b('<img id="showPrint" src="'+b.fn.jqBingMapSrc+"/themes/"+H.options.jqm.controlTheme+"/print.png?"+H.options.jqm.scriptVersion+' title="Print" />').appendTo(x).click(function(j){H.printMap.call(H,j)})}if(H.options.jqmDrawing.showCount){H.drawing.countContainerElement=b('<div class="countContainer ui-corner-all"/>').appendTo(y);H.drawing.countElement=b('<div id="divCount" class="f-ve-countbox"></div>').appendTo(H.drawing.countContainerElement);b('<div class="f-ve-count-label">Results</div>').appendTo(H.drawing.countContainerElement)}if(s>0){x.appendTo(y);if(H.options.jqm.menuType=="normal"){x.show()}else{x.jqDock({align:"top",labels:"bc",size:20})}}}if(H.options.jqmMenu.showShapeSummary){H.drawing.shapeSummaryElement=b('<div class="ui-corner-all" id="divShapeSummary"></div>');H.drawing.shapeSummaryElement.appendTo(y);b('<div class="shapeSummaryContainer">Shape Summary: (Max '+H.options.jqmDrawing.maxNumberShapes+")</div>").appendTo(H.drawing.shapeSummaryElement);if(H.options.jqmDrawing.allowShapeEdit){b('<div class="shapeEditInstructions">Click a shape name to edit.</div>').appendTo(H.drawing.shapeSummaryElement)}b('<div id="divShapes"></div>').appendTo(H.drawing.shapeSummaryElement)}if(H.options.jqm.showPinInfobox){H.pinInfobox.Container=b('<div class="pushpinPopup"></div>').mouseout(H.pinInfoboxMouseLeave).mouseover(H.pinInfoboxMouseEnter);H.pinInfobox.Container.appendTo(y);H.pinInfobox.ArrowLeft=b('<div class="pushpinPopupArrowLeft"></div>').appendTo(H.pinInfobox.Container);H.pinInfobox.ArrowLeft=b('<div class="pushpinPopupArrowRight"></div>').appendTo(H.pinInfobox.Container);H.pinInfobox.Title=b('<div class="pushpinPopupTitle"></div>').appendTo(H.pinInfobox.Container);H.pinInfobox.TitleLabel=b('<div class="pushpinPopupTitleLabel"></div>').appendTo(H.pinInfobox.Title);H.pinInfobox.Body=b('<div class="pushpinPopupBody"></div>').appendTo(H.pinInfobox.Container);H.pinInfobox.IconBar=b('<div class="pushpinPopupIconBar"></div>').appendTo(H.pinInfobox.Container);for(var u=0;u<H.options.jqm.pinInfoBoxIcons.length;u++){var r=H.options.jqm.pinInfoBoxIcons[u];b('<div rel="'+r.actionName+'" class="'+r.className+'"></div>').appendTo(H.pinInfobox.IconBar).click(function(j){var L=b(j.target);H.pinInfoBoxIconClick.call(H,j,L.parent().attr("rel"),L.attr("rel"))});if(u<H.options.jqm.pinInfoBoxIcons.length-1){b("<div> | </div>").appendTo(H.pinInfobox.IconBar)}}}if(H.options.jqm.showParcelInfobox){var m=H.options.jqmLayer.parcelInfobox;H.parcelInfobox.Container=b('<div class="'+m.CssClass+'"></div>');H.parcelInfobox.Container.appendTo(y);if(H.parcelInfobox.Title==null||H.parcelInfobox.Title.length==0){H.parcelInfobox.Title=b('<div class="jqmPrclInfbxtitle"></div>')}H.parcelInfobox.Container.append(H.parcelInfobox.Title);H.parcelInfobox.Body=b('<div class="parcelInfoboxBody" ></div>');H.parcelInfobox.Container.append(H.parcelInfobox.Body);H.parcelInfobox.IconBar=b('<div class="'+m.iconBarCss+'"></div>');H.parcelInfobox.Container.append(H.parcelInfobox.IconBar);H.parcelInfobox.ArrowLeft=b('<div class="'+m.ArrowLeftCss+'"></div>').appendTo(H.parcelInfobox.Container);H.parcelInfobox.ArrowRight=b('<div class="'+m.ArrowRightCss+'"></div>').appendTo(H.parcelInfobox.Container);H.parcelInfobox.ArrowUp=b('<div class="'+m.ArrowUpCss+'"></div>').appendTo(H.parcelInfobox.Container);H.parcelInfobox.ArrowDown=b('<div class="'+m.ArrowDownCss+'"></div>').appendTo(H.parcelInfobox.Container)}}H.setCenter(new Bing.Location(H.options.jqm.centerLatitude,H.options.jqm.centerLongitude))}function e(){var j=this;if((j.options.jqmMenu.showDrawingTools||j.options.jqmMenu.showShapeIcon)&&!j.drawing.shapeLayer){j.initShapeLayer()}Bing.Events.addHandler(j.map,"viewchange",function(k){j.viewChange(k)});Bing.Events.addHandler(j.map,"viewchangeend",function(k){j.viewChangeEnded(k)});Bing.Events.addHandler(j.map,"maptypechanged",function(k){j.mapTypeChange(k)});Bing.Events.addHandler(j.map,"imagerychanged",function(k){j.imageryChanged(k)});Bing.Events.addHandler(j.map,"mousewheel",function(k){j.mapMouseWheel(k)});Bing.Events.addHandler(j.map,"tiledownloadcomplete",function(){});if(j.options.jqm.menuType=="context"&&j.options.jqm.contextMenuContainer.$){Bing.Events.addHandler(j.map,"rightclick",function(k){j.mapRightClick(k)});b("body").contextmenu(function(){return false})}j.addPins(j.options.jqm.locations);if(j.options.jqmMenu.showLayer||j.options.jqmLayer.useLayer){j.initParcelMenu()}j.mapGrabCur=b("#"+j.options.mapDiv).find("div.MicrosoftMap").prop("style").cursor;j.postRender.call(j)}b.fn.jqBingMap.interfaces=[];b.fn.jqBingMap.defaults={credentials:"",customizeOverlays:true,enableClickableLogo:false,enableSearchLogo:false,showBreadcrumb:true,showCopyright:false,showDashboard:true,showLogo:false,disableMouseWheel:false,disableBirdseye:false,mapTypeId:Microsoft.Maps.MapTypeId.auto,zoom:-1,jqm:{bingApiUrl:"http://api.bing.net/json.aspx?",centerLatitude:null,centerLongitude:null,contextMenuContainer:document,controlTheme:"emo",countryRegion:"US",isTouchDevice:null,leftOffset:0,locations:null,menuType:"dock",pinWidth:21,pinHeight:22,pinTextOffsetX:0,pinTextOffsetY:0,pinInfoBoxDelay:0,useMiniInfoBoxOnHover:false,miniInfoBoxScale:5,shapeMenuDelay:600,pinInfoBoxIcons:[],displayPinText:true,restUrl:"http://dev.virtualearth.net/REST",restVersion:"v1",showCenterImage:true,showPinInfobox:false,showParcelInfobox:false,topOffset:0,autoUpdatePOIpins:false,maxPOIs:10,scriptVersion:"",fitToWindow:true,autoHandleAmbiguousAddresses:true},jqmDrawing:{createDrawingHiddenElements:false,maxNumberPolyPoints:50,maxNumberShapes:4,shapeInfo:null,showCount:false,shapeLineColor:{o:255,r:255,g:250,b:0},shapeFillColor:{o:123,r:3,g:77,b:89},highlightShapeLineColor:{o:255,r:0,g:255,b:127},highlightShapeFillColor:{o:123,r:255,g:240,b:0},excludeShapeLineColor:{o:255,r:215,g:0,b:0},excludeShapeFillColor:{o:123,r:144,g:0,b:0},shapeMouseOverLineColor:{o:225,r:0,g:191,b:255},shapeMouseOverFillColor:{o:255,r:0,g:255,b:255},strokeThickness:2,drawingCursor:"crosshair",shapeMoveCursor:"move",shapeHoverCursor:"default",allowShapeEdit:false,useShapeMenu:false,displayShapeLabel:false,displayShapeEditMessage:false},jqmLayer:{layerOptions:[{text:"None",value:"0",group:1},{text:"Parcel Lines",type:"DMP",value:"1",group:1,name:"ParcelLines",id:"ParcelLines",altResource:"DMP_LICENSE/Parcels",resourceName:"DMP_LICENSE/ParcelTiles",style:"",zIndex:3,minZoom:15,maxZoom:20,hide:false,dataQuery:"&fields=*,TAXLINK(*)&nested=true&showSchema=false&attributelinks=TAXLINK&LINKS={TAXLINK:{Class:'Dmp.Neptune.Links.KeyLink',To:'DMP_LICENSE/PropertyAddress',FromKey:'LOCID',ToKey:'LOCATION_ID'}}&account=lpspxl&login=LPSPXL&password=canyonlands"},{text:"Parcel Lines + ID",type:"DMP",value:"2",group:1,name:"Parcels",id:"Parcels",resourceName:"DMP_LICENSE/Parcels",style:"$(ACCOUNT_FOLDER)/sld/ReInsight_style_labels.sld.xml",zIndex:4,minZoom:15,maxZoom:20,hide:false,addIds:["ParcelLines"]},{text:"Neighborhoods",type:"DMP",value:"3",group:1,name:"Neighbor",id:"Neighbor",resourceName:"DMP_LICENSE/MaponicsNeighborhoods_DOFS",style:"$(ACCOUNT_FOLDER)/SLD/NEIGHBORHD.XML",zIndex:3,minZoom:10,maxZoom:20,hide:false,dataQuery:""},{text:"Neighborhoods + ID",type:"DMP",value:"4",group:1,name:"NeighborId",id:"NeighborId",resourceName:"DMP_LICENSE/MaponicsNeighborhoods_DOFS",style:"$(ACCOUNT_FOLDER)/SLD/NEIGHBORHDLabel.XML",zIndex:4,minZoom:10,maxZoom:20,hide:false,addIds:["Neighbor"]},{text:"Postal Codes",type:"DMP",value:"7",group:1,name:"PostalCodes",id:"PostalCodes",resourceName:"DMP_LICENSE/PostalCode_DOFS",style:"$(ACCOUNT_FOLDER)/SLD/Zip.sld.xml",zIndex:3,minZoom:7,maxZoom:19,hide:false},{text:"Postal Codes + ID",type:"DMP",value:"8",group:1,name:"PostalCodesId",id:"PostalCodesId",resourceName:"DMP_LICENSE/PostalCode_DOFS",style:"$(ACCOUNT_FOLDER)/SLD/ZipLabels.sld.xml",zIndex:4,minZoom:7,maxZoom:19,hide:false,addIds:["PostalCodes"]},{text:"City",type:"DMP",value:"9",group:1,name:"City",id:"City",resourceName:"DMP_LICENSE/City_DOFS",style:"$(ACCOUNT_FOLDER)/SLD/City.sld.xml",zIndex:3,minZoom:5,maxZoom:12,hide:false},{text:"City + ID",type:"DMP",value:"10",group:1,name:"CityId",id:"CityId",resourceName:"DMP_LICENSE/City_DOFS",style:"$(ACCOUNT_FOLDER)/SLD/CityLabels.sld.xml",zIndex:4,minZoom:5,maxZoom:12,hide:false,addIds:["City"]},{text:"County",type:"DMP",value:"11",group:1,name:"County",id:"County",resourceName:"DMP_LICENSE/County_DOFS",style:"$(ACCOUNT_FOLDER)/SLD/County.sld.xml",zIndex:3,minZoom:5,maxZoom:12,hide:false},{text:"County + ID",type:"DMP",value:"12",group:1,name:"CountyId",id:"CountyId",resourceName:"DMP_LICENSE/County_DOFS",style:"$(ACCOUNT_FOLDER)/SLD/CountyLabels.sld.xml",zIndex:4,minZoom:5,maxZoom:12,hide:false,addIds:["County"]},{text:"Flood Plain",type:"DMP",value:"14",group:1,name:"Flood",id:"Flood",resourceName:"DMP_LICENSE/DFIRM",style:"PUBLIC_FOLDER/Styles/DFIRM/Default.sld.xml",zIndex:3,minZoom:5,maxZoom:17,hide:false},{text:"Traffic",type:"BingTraffic",value:"13",group:2,hide:false}],clickableLayers:["ParcelLines","Neighbor"],excludeLayers:["Flood"],spatialStreamKey:"",layerValue:"0",useLayer:false,parcelLayerInteractive:false,parcelSelectFillColor:{o:51,r:3,g:77,b:89},parcelSelectLineColor:{o:255,r:0,g:255,b:255},parcelSelectLineThickness:1,parcelDimensionOptions:{None:"",Area:"PUBLIC_FOLDER/Styles/Measurement_USArea.sld.xml",Boundry:"PUBLIC_FOLDER/Styles/Measurement_USBoundary.sld.xml",AreaAndBoundry:"PUBLIC_FOLDER/Styles/Measurement_USAreaBoundary.sld.xml"},parcelDimensionOption:"AreaAndBoundry",parcelInfobox:{title:"Parcel Information",addApn:true,addFips:true,height:126,width:256,iconBar:null,iconBarActions:[],reportFunction:null,titleActionItem:"",titleClickHandler:null,htmlContent:"",CssClass:"jqmParcelPopup",iconBarCss:"parcelInfoboxIconBar",useArrows:true,ArrowLeftCss:"parcelPopupArrowLeft",ArrowRightCss:"parcelPopupArrowRight",ArrowUpCss:"parcelPopupArrowUp",ArrowDownCss:"parcelPopupArrowDown"}},jqmMenu:{addressInfo:{address:"",city:"",state:"",zip:""},legendItems:[],poiItems:[{className:"poischools",description:"Schools",searchItem:"SCHOOLS",mapIcon:"poimapschools"},{className:"poidaycare",description:"Day Care",searchItem:"DAY CARE",mapIcon:"poimapdaycare"},{className:"poishopping",description:"Shopping",searchItem:"SHOPPING",mapIcon:"poimapshopping"},{className:"poifood",description:"Food",searchItem:"FOOD",mapIcon:"poimapfood"},{className:"poigrocery",description:"Grocery",searchItem:"GROCERY",mapIcon:"poimapgrocery"},{className:"poiworship",description:"Worship",searchItem:"WORSHIP",mapIcon:"poimapworship"},{className:"poilibrary",description:"Library",searchItem:"LIBRARY",mapIcon:"poimaplibrary"},{className:"poibanks",description:"Banks",searchItem:"BANKS",mapIcon:"poimapbanks"},{className:"poirecreation",description:"Recreation",searchItem:"RECREATION",mapIcon:"poimaprecreation"},{className:"poiairport",description:"Airport",searchItem:"AIRPORT",mapIcon:"poimapairport"},{className:"poihotel",description:"Hotel",searchItem:"HOTEL",mapIcon:"poimaphotel"},{className:"poigas",description:"Gas",searchItem:"GAS",mapIcon:"poimapgas"},{className:"poipostoffice",description:"Post Office",searchItem:"POST OFFICE",mapIcon:"poimappostoffice"},{className:"poisiteseeing",description:"Site Seeing",searchItem:"SITE SEEING",mapIcon:"poimapsiteseeing"},{className:"poipolicedepartment",description:"Police Department",searchItem:"POLICE DEPARTMENT",mapIcon:"poimappolicedepartment"},{className:"poihospitals",description:"Hospitals",searchItem:"HOSPITALS",mapIcon:"poimaphospitals"},{className:"poifiredepartment",description:"Fire Department",searchItem:"FIRE DEPARTMENT",mapIcon:"poimapfiredepartment"}],poiShowUserRating:false,resizeItems:[{description:"Small",width:405,height:320},{description:"Medium",width:575,height:470},{description:"Large",width:800,height:580}],showAddress:false,showDrawingTools:false,showLegend:false,showLocator:false,showLayer:false,showPoi:false,showPrint:false,showResize:false,showShapeSummary:false,showExcludeOnShapeSummary:false,showShapeIcon:false,showDrivingDirections:false,showPinLayerPicker:false,rubberbandName:"RubberBand"},jqmApi:{beforeRender:function(){},postRender:function(){},beforeDestroy:function(){},pushpinClick:function(){},pushpinMouseover:function(){},pushpinMouseout:function(){},parcelClick:function(){},beforeParcelInfobox:null,addedShape:function(){},beforeDrawShape:function(){},beforeEditShape:function(){},afterEditShape:function(){},deletedShape:function(){},selectedShape:function(){},pinInfoBoxIconClick:function(){},pushpinMoved:function(){},viewChangeEnd:function(){},mapTypeChanged:function(){},resizeMapItem:function(){},onShowDirections:function(){},onHideDirections:function(){},onSetPushpinHtml:function(){return""},onSetPushpinHtmlForMini:function(){return""},getCheckedIds:null}}})(jQuery);